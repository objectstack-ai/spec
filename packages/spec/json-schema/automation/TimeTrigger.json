{
  "$ref": "#/definitions/TimeTrigger",
  "definitions": {
    "TimeTrigger": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier"
        },
        "timeLength": {
          "type": "integer",
          "description": "Duration amount (e.g. 1, 30)"
        },
        "timeUnit": {
          "type": "string",
          "enum": [
            "minutes",
            "hours",
            "days"
          ],
          "description": "Unit of time"
        },
        "offsetDirection": {
          "type": "string",
          "enum": [
            "before",
            "after"
          ],
          "description": "Before or After the reference date"
        },
        "offsetFrom": {
          "type": "string",
          "enum": [
            "trigger_date",
            "date_field"
          ],
          "description": "Basis for calculation"
        },
        "dateField": {
          "type": "string",
          "description": "Date field to calculate from (required if offsetFrom is date_field)"
        },
        "actions": {
          "type": "array",
          "items": {
            "anyOf": [
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "field_update"
                  },
                  "field": {
                    "type": "string",
                    "description": "Field to update"
                  },
                  "value": {
                    "description": "Value or Formula to set"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "field"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "email_alert"
                  },
                  "template": {
                    "type": "string",
                    "description": "Email template ID/DevName"
                  },
                  "recipients": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "List of recipient emails or user IDs"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "template",
                  "recipients"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "sms_notification"
                  },
                  "provider": {
                    "type": "string",
                    "enum": [
                      "twilio",
                      "vonage"
                    ],
                    "description": "SMS provider"
                  },
                  "recipients": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "List of phone numbers or user field references"
                  },
                  "message": {
                    "type": "string",
                    "description": "SMS message text or template"
                  },
                  "fromNumber": {
                    "type": "string",
                    "description": "Sender phone number (provider-specific)"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "provider",
                  "recipients",
                  "message"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "slack_message"
                  },
                  "channel": {
                    "type": "string",
                    "description": "Slack channel ID or name (#channel)"
                  },
                  "message": {
                    "type": "string",
                    "description": "Message text with optional markdown"
                  },
                  "mentions": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "User IDs or @username to mention"
                  },
                  "threadId": {
                    "type": "string",
                    "description": "Thread ID for replies"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "channel",
                  "message"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "teams_message"
                  },
                  "channel": {
                    "type": "string",
                    "description": "Teams channel ID"
                  },
                  "message": {
                    "type": "string",
                    "description": "Message text with optional markdown"
                  },
                  "mentions": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "User IDs to mention"
                  },
                  "teamId": {
                    "type": "string",
                    "description": "Team ID (if not in default team)"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "channel",
                  "message"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "http_call"
                  },
                  "url": {
                    "type": "string",
                    "description": "Target URL"
                  },
                  "method": {
                    "type": "string",
                    "enum": [
                      "GET",
                      "POST",
                      "PUT",
                      "PATCH",
                      "DELETE"
                    ],
                    "description": "HTTP method"
                  },
                  "headers": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    },
                    "description": "Request headers"
                  },
                  "body": {
                    "description": "Request body (object/string)"
                  },
                  "authentication": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "none",
                          "basic",
                          "bearer",
                          "api_key",
                          "oauth2"
                        ]
                      },
                      "credentials": {
                        "type": "object",
                        "additionalProperties": {
                          "type": "string"
                        }
                      }
                    },
                    "required": [
                      "type"
                    ],
                    "additionalProperties": false,
                    "description": "Authentication configuration"
                  },
                  "timeout": {
                    "type": "number",
                    "description": "Request timeout in milliseconds"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "url",
                  "method"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "webhook_trigger"
                  },
                  "config": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string",
                        "minLength": 2,
                        "pattern": "^[a-z][a-z0-9_]*$",
                        "description": "Webhook unique name (lowercase snake_case)"
                      },
                      "label": {
                        "type": "string",
                        "description": "Human-readable webhook label"
                      },
                      "object": {
                        "type": "string",
                        "description": "Object to listen to (optional for manual webhooks)"
                      },
                      "triggers": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "enum": [
                            "create",
                            "update",
                            "delete",
                            "undelete",
                            "api"
                          ]
                        },
                        "description": "Events that trigger execution"
                      },
                      "url": {
                        "type": "string",
                        "format": "uri",
                        "description": "External webhook endpoint URL"
                      },
                      "method": {
                        "type": "string",
                        "enum": [
                          "GET",
                          "POST",
                          "PUT",
                          "PATCH",
                          "DELETE"
                        ],
                        "default": "POST",
                        "description": "HTTP method"
                      },
                      "headers": {
                        "type": "object",
                        "additionalProperties": {
                          "type": "string"
                        },
                        "description": "Custom HTTP headers"
                      },
                      "body": {
                        "description": "Request body payload (if not using default record data)"
                      },
                      "payloadFields": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "description": "Fields to include. Empty = All"
                      },
                      "includeSession": {
                        "type": "boolean",
                        "default": false,
                        "description": "Include user session info"
                      },
                      "authentication": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "enum": [
                              "none",
                              "bearer",
                              "basic",
                              "api-key"
                            ],
                            "description": "Authentication type"
                          },
                          "credentials": {
                            "type": "object",
                            "additionalProperties": {
                              "type": "string"
                            },
                            "description": "Authentication credentials"
                          }
                        },
                        "required": [
                          "type"
                        ],
                        "additionalProperties": false,
                        "description": "Authentication configuration"
                      },
                      "retryPolicy": {
                        "type": "object",
                        "properties": {
                          "maxRetries": {
                            "type": "integer",
                            "minimum": 0,
                            "maximum": 10,
                            "default": 3,
                            "description": "Maximum retry attempts"
                          },
                          "backoffStrategy": {
                            "type": "string",
                            "enum": [
                              "exponential",
                              "linear",
                              "fixed"
                            ],
                            "default": "exponential",
                            "description": "Backoff strategy"
                          },
                          "initialDelayMs": {
                            "type": "integer",
                            "minimum": 100,
                            "default": 1000,
                            "description": "Initial retry delay in milliseconds"
                          },
                          "maxDelayMs": {
                            "type": "integer",
                            "minimum": 1000,
                            "default": 60000,
                            "description": "Maximum retry delay in milliseconds"
                          }
                        },
                        "additionalProperties": false,
                        "description": "Retry policy configuration"
                      },
                      "timeoutMs": {
                        "type": "integer",
                        "minimum": 1000,
                        "maximum": 300000,
                        "default": 30000,
                        "description": "Request timeout in milliseconds"
                      },
                      "secret": {
                        "type": "string",
                        "description": "Signing secret for HMAC signature verification"
                      },
                      "isActive": {
                        "type": "boolean",
                        "default": true,
                        "description": "Whether webhook is active"
                      },
                      "description": {
                        "type": "string",
                        "description": "Webhook description"
                      },
                      "tags": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "description": "Tags for organization"
                      }
                    },
                    "required": [
                      "name",
                      "url"
                    ],
                    "additionalProperties": false,
                    "description": "Webhook configuration (references canonical schema)"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "config"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "task_creation"
                  },
                  "taskObject": {
                    "type": "string",
                    "description": "Task object name (e.g., \"task\", \"project_task\")"
                  },
                  "subject": {
                    "type": "string",
                    "description": "Task subject/title"
                  },
                  "description": {
                    "type": "string",
                    "description": "Task description"
                  },
                  "assignedTo": {
                    "type": "string",
                    "description": "User ID or field reference for assignee"
                  },
                  "dueDate": {
                    "type": "string",
                    "description": "Due date (ISO string or formula)"
                  },
                  "priority": {
                    "type": "string",
                    "description": "Task priority"
                  },
                  "relatedTo": {
                    "type": "string",
                    "description": "Related record ID or field reference"
                  },
                  "additionalFields": {
                    "type": "object",
                    "additionalProperties": {},
                    "description": "Additional custom fields"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "taskObject",
                  "subject"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "push_notification"
                  },
                  "title": {
                    "type": "string",
                    "description": "Notification title"
                  },
                  "body": {
                    "type": "string",
                    "description": "Notification body text"
                  },
                  "recipients": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "User IDs or device tokens"
                  },
                  "data": {
                    "type": "object",
                    "additionalProperties": {},
                    "description": "Additional data payload"
                  },
                  "badge": {
                    "type": "number",
                    "description": "Badge count (iOS)"
                  },
                  "sound": {
                    "type": "string",
                    "description": "Notification sound"
                  },
                  "clickAction": {
                    "type": "string",
                    "description": "Action/URL when notification is clicked"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "title",
                  "body",
                  "recipients"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Action name"
                  },
                  "type": {
                    "type": "string",
                    "const": "custom_script"
                  },
                  "language": {
                    "type": "string",
                    "enum": [
                      "javascript",
                      "typescript",
                      "python"
                    ],
                    "default": "javascript",
                    "description": "Script language"
                  },
                  "code": {
                    "type": "string",
                    "description": "Script code to execute"
                  },
                  "timeout": {
                    "type": "number",
                    "default": 30000,
                    "description": "Execution timeout in milliseconds"
                  },
                  "context": {
                    "type": "object",
                    "additionalProperties": {},
                    "description": "Additional context variables"
                  }
                },
                "required": [
                  "name",
                  "type",
                  "code"
                ],
                "additionalProperties": false
              }
            ]
          },
          "description": "Actions to execute at the scheduled time"
        }
      },
      "required": [
        "timeLength",
        "timeUnit",
        "offsetDirection",
        "offsetFrom",
        "actions"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}