{
  "$ref": "#/definitions/PermissionSet",
  "definitions": {
    "PermissionSet": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 2,
          "pattern": "^[a-z][a-z0-9_]*$",
          "description": "Permission set unique name (lowercase snake_case)"
        },
        "label": {
          "type": "string",
          "description": "Display label"
        },
        "isProfile": {
          "type": "boolean",
          "default": false,
          "description": "Whether this is a user profile"
        },
        "objects": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "allowCreate": {
                "type": "boolean",
                "default": false,
                "description": "Create permission"
              },
              "allowRead": {
                "type": "boolean",
                "default": false,
                "description": "Read permission"
              },
              "allowEdit": {
                "type": "boolean",
                "default": false,
                "description": "Edit permission"
              },
              "allowDelete": {
                "type": "boolean",
                "default": false,
                "description": "Delete permission"
              },
              "allowTransfer": {
                "type": "boolean",
                "default": false,
                "description": "Change record ownership"
              },
              "allowRestore": {
                "type": "boolean",
                "default": false,
                "description": "Restore from trash (Undelete)"
              },
              "allowPurge": {
                "type": "boolean",
                "default": false,
                "description": "Permanently delete (Hard Delete/GDPR)"
              },
              "viewAllRecords": {
                "type": "boolean",
                "default": false,
                "description": "View All Data (Bypass Sharing)"
              },
              "modifyAllRecords": {
                "type": "boolean",
                "default": false,
                "description": "Modify All Data (Bypass Sharing)"
              }
            },
            "additionalProperties": false
          },
          "description": "Entity permissions"
        },
        "fields": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "readable": {
                "type": "boolean",
                "default": true,
                "description": "Field read access"
              },
              "editable": {
                "type": "boolean",
                "default": false,
                "description": "Field edit access"
              }
            },
            "additionalProperties": false
          },
          "description": "Field level security"
        },
        "systemPermissions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "System level capabilities"
        },
        "rls": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "pattern": "^[a-z_][a-z0-9_]*$",
                "description": "Rule unique identifier (snake_case)"
              },
              "objectName": {
                "type": "string",
                "description": "Target object name"
              },
              "operation": {
                "type": "string",
                "enum": [
                  "read",
                  "create",
                  "update",
                  "delete"
                ],
                "description": "Database operation this rule applies to"
              },
              "filter": {
                "type": "object",
                "properties": {
                  "field": {
                    "type": "string",
                    "description": "Field name to filter on"
                  },
                  "operator": {
                    "type": "string",
                    "enum": [
                      "eq",
                      "ne",
                      "in",
                      "nin",
                      "gt",
                      "gte",
                      "lt",
                      "lte"
                    ],
                    "description": "Filter operator"
                  },
                  "value": {
                    "anyOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "number"
                      },
                      {
                        "type": "boolean"
                      },
                      {
                        "type": "array"
                      },
                      {
                        "type": "object",
                        "properties": {
                          "contextVariable": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "contextVariable"
                        ],
                        "additionalProperties": false,
                        "description": "Reference to context variable (e.g., { contextVariable: \"current_user.tenant_id\" })"
                      }
                    ],
                    "description": "Filter value or context variable reference"
                  }
                },
                "required": [
                  "field",
                  "operator",
                  "value"
                ],
                "additionalProperties": false,
                "description": "Filter condition for row-level access"
              },
              "enabled": {
                "type": "boolean",
                "default": true,
                "description": "Whether this rule is active"
              },
              "priority": {
                "type": "number",
                "default": 0,
                "description": "Rule evaluation priority (higher = evaluated first)"
              }
            },
            "required": [
              "name",
              "objectName",
              "operation",
              "filter"
            ],
            "additionalProperties": false
          },
          "description": "Row-level security rules"
        },
        "contextVariables": {
          "type": "object",
          "additionalProperties": {},
          "description": "Context variables for RLS evaluation"
        }
      },
      "required": [
        "name",
        "objects"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}