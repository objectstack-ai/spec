# ObjectStack 业务开发元数据清单

> **业务应用开发核心元数据参考指南**  
> **版本**: 1.0.0  
> **日期**: 2026-01-31  
> **适用场景**: 企业管理软件开发、低代码平台、业务应用构建

---

## 📖 文档概述

本文档提供基于 `@objectstack/spec` 规范的业务开发元数据清单，帮助开发者和AI Agent理解并使用ObjectStack协议构建企业管理软件。

**目标读者**:
- AI Agent开发者
- 企业应用架构师
- 低代码平台开发者
- 业务系统集成工程师

---

## 🎯 业务开发核心元数据分类

ObjectStack 提供 13 个协议类别，共计 **108+ 个元数据定义**。以下按业务开发优先级分类：

### 优先级说明
- 🟢 **P0 核心** - 必须掌握，所有业务应用的基础
- 🟡 **P1 重要** - 大部分企业应用需要
- 🔵 **P2 扩展** - 高级功能和企业级特性
- ⚪ **P3 可选** - 特定场景使用

---

## 1️⃣ 数据层协议 (ObjectQL)

### 🟢 P0 核心元数据

#### 1.1 Object (对象定义)
**协议位置**: `packages/spec/src/data/object.zod.ts`

**核心概念**: 业务实体的结构化定义（如：客户、订单、产品）

**关键属性**:
```typescript
interface ServiceObject {
  name: string;              // 对象名称 (snake_case): 'customer', 'project_task'
  label: string;             // 显示标签: '客户', '项目任务'
  pluralLabel?: string;      // 复数标签: '客户们', '项目任务列表'
  description?: string;      // 对象描述
  fields: Record<string, Field>;  // 字段定义
  primaryKey?: string;       // 主键字段
  enable?: {                 // 功能开关
    trackHistory?: boolean;  // 启用历史记录
    apiEnabled?: boolean;    // 启用API访问
    search?: boolean;        // 启用搜索
    activities?: boolean;    // 启用活动流
  };
  validation?: Validation;   // 验证规则
  hooks?: Hook[];           // 生命周期钩子
}
```

**业务场景**:
- 客户关系管理 (CRM): `customer`, `account`, `contact`
- 项目管理 (PM): `project`, `task`, `milestone`
- 库存管理: `product`, `inventory`, `warehouse`
- 订单管理: `order`, `order_item`, `shipment`

**示例**: 参考 `examples/crm/src/domains/crm/account.object.ts`

---

#### 1.2 Field (字段定义)
**协议位置**: `packages/spec/src/data/field.zod.ts`

**核心概念**: 对象的属性定义，支持 28+ 种字段类型

**常用字段类型**:

| 类型 | 用途 | 示例 |
|------|------|------|
| `text` | 短文本 | 姓名、邮箱、电话 |
| `textarea` | 长文本 | 描述、备注 |
| `number` | 数字 | 价格、数量、年龄 |
| `boolean` | 布尔值 | 是否激活、是否VIP |
| `select` | 单选下拉 | 状态、类型、优先级 |
| `multiselect` | 多选下拉 | 标签、分类 |
| `date` | 日期 | 生日、创建日期 |
| `datetime` | 日期时间 | 创建时间、修改时间 |
| `lookup` | 引用关系 | 所属客户、负责人 |
| `master_detail` | 主从关系 | 订单明细、项目任务 |
| `formula` | 计算字段 | 总价 = 单价 × 数量 |
| `rollup` | 汇总字段 | 订单总额、任务完成率 |
| `currency` | 货币 | 年收入、合同金额 |
| `percent` | 百分比 | 折扣率、完成进度 |
| `email` | 邮箱 | 联系邮箱、工作邮箱 |
| `phone` | 电话 | 联系电话、传真 |
| `url` | URL | 公司网站、社交媒体 |
| `image` | 图片 | 头像、产品图片 |
| `file` | 文件 | 合同附件、文档 |

**字段定义示例**:
```typescript
// 文本字段
{
  type: 'text',
  label: '客户名称',
  required: true,
  maxLength: 100,
  unique: true
}

// 引用字段 (Lookup)
{
  type: 'lookup',
  label: '所属客户',
  reference: { object: 'account' },
  relationshipType: 'lookup'  // 或 'master_detail'
}

// 计算字段 (Formula)
{
  type: 'formula',
  label: '全名',
  returnType: 'text',
  formula: 'CONCATENATE(first_name, " ", last_name)'
}

// 下拉选择
{
  type: 'select',
  label: '状态',
  options: [
    { value: 'draft', label: '草稿' },
    { value: 'active', label: '激活' },
    { value: 'archived', label: '归档' }
  ]
}
```

---

#### 1.3 Validation (验证规则)
**协议位置**: `packages/spec/src/data/validation.zod.ts`

**核心概念**: 数据质量保证，业务规则强制执行

**验证类型**:
```typescript
interface ValidationRule {
  name: string;              // 规则名称
  errorMessage: string;      // 错误提示
  formula?: string;          // 验证公式
  active?: boolean;          // 是否启用
}
```

**常见业务规则**:
```typescript
// 数值范围验证
{
  name: 'valid_discount',
  errorMessage: '折扣率必须在0-100之间',
  formula: 'discount_rate >= 0 && discount_rate <= 100'
}

// 日期逻辑验证
{
  name: 'valid_dates',
  errorMessage: '结束日期必须晚于开始日期',
  formula: 'end_date > start_date'
}

// 依赖字段验证
{
  name: 'vip_customer_annual_revenue',
  errorMessage: 'VIP客户年收入必须大于100万',
  formula: 'IF(is_vip, annual_revenue > 1000000, TRUE)'
}
```

**示例**: 参考 `examples/crm/src/domains/crm/account.object.ts`

---

#### 1.4 Query & Filter (查询与过滤)
**协议位置**: `packages/spec/src/data/query.zod.ts`, `filter.zod.ts`

**核心概念**: 数据检索和条件筛选

**查询结构**:
```typescript
interface Query {
  object: string;           // 对象名称
  fields?: string[];        // 返回字段列表
  filter?: Filter;          // 过滤条件
  sort?: Sort[];            // 排序规则
  limit?: number;           // 返回数量
  offset?: number;          // 偏移量
}
```

**过滤操作符**:
| 操作符 | 说明 | 示例 |
|--------|------|------|
| `equals` | 等于 | `status = 'active'` |
| `not_equals` | 不等于 | `status != 'deleted'` |
| `contains` | 包含 | `name LIKE '%公司%'` |
| `starts_with` | 开头匹配 | `code LIKE 'CUS-%'` |
| `greater_than` | 大于 | `amount > 10000` |
| `less_than` | 小于 | `created_at < '2024-01-01'` |
| `in` | 在列表中 | `status IN ['active', 'pending']` |
| `is_null` | 为空 | `deleted_at IS NULL` |
| `and` | 逻辑与 | 多条件组合 |
| `or` | 逻辑或 | 多条件组合 |

**业务查询示例**:
```typescript
// 查询VIP客户，年收入大于100万，按创建时间倒序
{
  object: 'account',
  fields: ['name', 'annual_revenue', 'created_at'],
  filter: {
    and: [
      { field: 'is_vip', operator: 'equals', value: true },
      { field: 'annual_revenue', operator: 'greater_than', value: 1000000 }
    ]
  },
  sort: [{ field: 'created_at', direction: 'desc' }],
  limit: 50
}
```

---

#### 1.5 Hook (生命周期钩子)
**协议位置**: `packages/spec/src/data/hook.zod.ts`

**核心概念**: 在数据变更时触发业务逻辑

**钩子类型**:
- `before_create`: 创建前
- `after_create`: 创建后
- `before_update`: 更新前
- `after_update`: 更新后
- `before_delete`: 删除前
- `after_delete`: 删除后

**业务场景**:
```typescript
// 自动编号
{
  type: 'before_create',
  handler: async (context) => {
    context.record.customer_code = await generateCustomerCode();
  }
}

// 审计日志
{
  type: 'after_update',
  handler: async (context) => {
    await auditLog.record({
      object: context.object,
      recordId: context.record.id,
      changes: context.changes,
      userId: context.user.id
    });
  }
}

// 级联更新
{
  type: 'after_update',
  handler: async (context) => {
    if (context.changes.includes('account_name')) {
      await updateRelatedContacts(context.record.id, context.record.account_name);
    }
  }
}
```

**示例**: 参考 `examples/crm/src/domains/crm/account.hook.ts`

---

### 🟡 P1 重要元数据

#### 1.6 Driver (数据驱动)
**协议位置**: `packages/spec/src/data/driver.zod.ts`, `packages/spec/src/system/driver.zod.ts`

**核心概念**: 数据库抽象层，支持多种存储后端

**支持的驱动类型**:
- **SQL**: PostgreSQL, MySQL, SQLite
- **NoSQL**: MongoDB, Redis
- **Cloud**: DynamoDB, Firestore
- **Memory**: 内存存储（开发/测试）

**驱动能力**:
```typescript
interface DriverCapabilities {
  transactions: boolean;           // 事务支持
  queryFilters: FilterOperator[];  // 支持的过滤操作符
  queryAggregations: string[];     // 聚合函数 (SUM, AVG, COUNT...)
  querySorting: boolean;           // 排序支持
  queryPagination: boolean;        // 分页支持
  queryWindowFunctions: boolean;   // 窗口函数
  querySubqueries: boolean;        // 子查询
}
```

**示例**: 参考 `packages/driver-memory/src/memory-driver.ts`

---

#### 1.7 Dataset (虚拟数据集)
**协议位置**: `packages/spec/src/data/dataset.zod.ts`

**核心概念**: 虚拟视图，无需物理存储

**业务场景**:
- 跨对象联合查询
- 复杂报表数据源
- 数据聚合视图

```typescript
{
  name: 'high_value_customers',
  label: '高价值客户',
  query: {
    object: 'account',
    filter: {
      and: [
        { field: 'annual_revenue', operator: 'greater_than', value: 1000000 },
        { field: 'status', operator: 'equals', value: 'active' }
      ]
    }
  }
}
```

---

## 2️⃣ UI层协议 (ObjectUI)

### 🟢 P0 核心元数据

#### 2.1 View (视图定义)
**协议位置**: `packages/spec/src/ui/view.zod.ts`

**核心概念**: 数据展示和交互界面

**视图类型**:

| 类型 | 用途 | 业务场景 |
|------|------|----------|
| `list` | 列表视图 | 客户列表、订单列表 |
| `grid` | 表格视图 | 数据表格、批量编辑 |
| `kanban` | 看板视图 | 销售管道、任务看板 |
| `calendar` | 日历视图 | 日程安排、会议管理 |
| `gantt` | 甘特图 | 项目进度、资源规划 |
| `form` | 表单视图 | 创建/编辑记录 |
| `detail` | 详情视图 | 记录详情页 |

**列表视图示例**:
```typescript
{
  name: 'active_customers',
  label: '活跃客户',
  type: 'grid',
  object: 'account',
  columns: [
    { field: 'name', label: '客户名称', width: 200 },
    { field: 'annual_revenue', label: '年收入', width: 150 },
    { field: 'industry', label: '行业', width: 120 },
    { field: 'created_at', label: '创建时间', width: 150 }
  ],
  filter: { field: 'status', operator: 'equals', value: 'active' },
  sort: [{ field: 'created_at', direction: 'desc' }]
}
```

**表单视图示例**:
```typescript
{
  name: 'customer_form',
  label: '客户表单',
  type: 'form',
  object: 'account',
  layout: 'two_column',
  sections: [
    {
      label: '基本信息',
      fields: ['name', 'industry', 'website']
    },
    {
      label: '联系方式',
      fields: ['email', 'phone', 'address']
    },
    {
      label: '财务信息',
      fields: ['annual_revenue', 'employee_count']
    }
  ]
}
```

**示例**: 参考 `examples/crm/src/ui/views.ts`

---

#### 2.2 App (应用定义)
**协议位置**: `packages/spec/src/ui/app.zod.ts`

**核心概念**: 应用容器，组织导航和功能模块

**应用结构**:
```typescript
interface App {
  name: string;              // 应用名称
  label: string;             // 显示标签
  description?: string;      // 应用描述
  navigation: NavItem[];     // 导航菜单
  branding?: {               // 品牌设置
    logo?: string;
    primaryColor?: string;
    secondaryColor?: string;
  };
}
```

**导航类型**:
```typescript
// 对象导航
{
  type: 'object',
  object: 'account',
  label: '客户',
  icon: 'building',
  defaultView: 'active_customers'
}

// 仪表盘导航
{
  type: 'dashboard',
  dashboard: 'sales_dashboard',
  label: '销售仪表盘',
  icon: 'chart-bar'
}

// 分组导航
{
  type: 'group',
  label: '销售管理',
  children: [
    { type: 'object', object: 'lead', label: '销售线索' },
    { type: 'object', object: 'opportunity', label: '销售机会' },
    { type: 'object', object: 'quote', label: '报价单' }
  ]
}
```

**示例**: 参考 `examples/crm/objectstack.config.ts`

---

#### 2.3 Action (自定义动作)
**协议位置**: `packages/spec/src/ui/action.zod.ts`

**核心概念**: 自定义按钮和业务操作

**动作类型**:
| 类型 | 用途 | 示例 |
|------|------|------|
| `button` | 按钮操作 | 审批、导出、发送邮件 |
| `url` | URL跳转 | 打开外部链接 |
| `modal` | 弹窗 | 确认对话框、表单输入 |
| `flow` | 流程触发 | 启动工作流 |
| `script` | 脚本执行 | 自定义逻辑 |

**业务场景**:
```typescript
// 批量导出
{
  name: 'export_customers',
  label: '导出客户',
  type: 'button',
  icon: 'download',
  handler: async (context) => {
    const records = context.selectedRecords;
    await exportToCSV(records, 'customers.csv');
  }
}

// 发送邮件
{
  name: 'send_welcome_email',
  label: '发送欢迎邮件',
  type: 'button',
  icon: 'envelope',
  condition: 'status == "active"',
  handler: async (context) => {
    await sendEmail({
      to: context.record.email,
      template: 'welcome',
      data: context.record
    });
  }
}

// 审批流程
{
  name: 'approve_quote',
  label: '审批报价',
  type: 'button',
  icon: 'check',
  handler: async (context) => {
    await triggerFlow('quote_approval', context.record);
  }
}
```

**示例**: 参考 `examples/crm/src/ui/actions.ts`

---

### 🟡 P1 重要元数据

#### 2.4 Dashboard (仪表盘)
**协议位置**: `packages/spec/src/ui/dashboard.zod.ts`

**核心概念**: 数据可视化和关键指标展示

**布局系统**: 网格布局 (12列)

**组件类型**:
```typescript
// 数字指标卡
{
  type: 'metric',
  title: '本月新增客户',
  query: {
    object: 'account',
    aggregation: 'count',
    filter: { 
      field: 'created_at', 
      operator: 'greater_than', 
      value: 'THIS_MONTH' 
    }
  },
  position: { x: 0, y: 0, width: 3, height: 2 }
}

// 图表组件
{
  type: 'chart',
  title: '月度销售趋势',
  chartType: 'line',
  query: {
    object: 'opportunity',
    groupBy: 'created_month',
    aggregation: { field: 'amount', function: 'sum' }
  },
  position: { x: 3, y: 0, width: 6, height: 4 }
}

// 列表组件
{
  type: 'list',
  title: '待跟进客户',
  query: {
    object: 'account',
    filter: { field: 'follow_up_date', operator: 'equals', value: 'TODAY' },
    limit: 10
  },
  position: { x: 9, y: 0, width: 3, height: 6 }
}
```

**示例**: 参考 `examples/crm/src/ui/dashboards.ts`

---

#### 2.5 Report (报表)
**协议位置**: `packages/spec/src/ui/report.zod.ts`

**核心概念**: 数据分析和报告生成

**报表类型**:
| 类型 | 用途 | 示例 |
|------|------|------|
| `tabular` | 表格报表 | 客户清单、订单明细 |
| `summary` | 汇总报表 | 按行业汇总客户数 |
| `matrix` | 矩阵报表 | 按地区和产品交叉分析销售额 |
| `chart` | 图表报表 | 销售趋势图、客户分布饼图 |

**报表示例**:
```typescript
{
  name: 'revenue_by_industry',
  label: '按行业统计收入',
  type: 'summary',
  object: 'account',
  groupBy: ['industry'],
  aggregations: [
    { field: 'annual_revenue', function: 'sum', label: '总收入' },
    { field: 'id', function: 'count', label: '客户数量' },
    { field: 'annual_revenue', function: 'avg', label: '平均收入' }
  ],
  sort: [{ field: 'sum_annual_revenue', direction: 'desc' }]
}
```

**示例**: 参考 `examples/crm/src/ui/reports.ts`

---

#### 2.6 Chart (图表)
**协议位置**: `packages/spec/src/ui/chart.zod.ts`

**核心概念**: 数据可视化图表

**图表类型**:
- `bar`: 柱状图
- `line`: 折线图
- `pie`: 饼图
- `donut`: 环形图
- `area`: 面积图
- `scatter`: 散点图
- `funnel`: 漏斗图
- `gauge`: 仪表盘

**业务场景**:
```typescript
// 销售漏斗
{
  type: 'funnel',
  title: '销售漏斗',
  stages: [
    { name: '销售线索', value: 1000 },
    { name: '合格线索', value: 500 },
    { name: '销售机会', value: 200 },
    { name: '方案/报价', value: 100 },
    { name: '谈判/审核', value: 50 },
    { name: '成交', value: 30 }
  ]
}
```

---

## 3️⃣ 自动化协议 (Automation)

### 🟡 P1 重要元数据

#### 3.1 Workflow (工作流)
**协议位置**: `packages/spec/src/automation/workflow.zod.ts`

**核心概念**: 业务流程自动化

**触发类型**:
- `on_create`: 创建时触发
- `on_update`: 更新时触发
- `on_create_or_update`: 创建或更新时触发
- `on_delete`: 删除时触发
- `schedule`: 定时触发

**动作类型**:
- `field_update`: 字段更新
- `create_record`: 创建记录
- `send_email`: 发送邮件
- `call_api`: 调用API
- `execute_script`: 执行脚本

**业务场景**:
```typescript
// 自动分配负责人
{
  name: 'auto_assign_owner',
  label: '自动分配负责人',
  object: 'lead',
  triggerType: 'on_create',
  conditions: { field: 'source', operator: 'equals', value: 'web' },
  actions: [
    {
      type: 'field_update',
      field: 'owner_id',
      value: 'ROUND_ROBIN(users, department = "sales")'
    }
  ]
}

// 客户状态变更通知
{
  name: 'notify_status_change',
  label: '状态变更通知',
  object: 'account',
  triggerType: 'on_update',
  conditions: { field: 'status', operator: 'changed' },
  actions: [
    {
      type: 'send_email',
      to: '{{owner.email}}',
      template: 'account_status_change',
      data: {
        accountName: '{{name}}',
        oldStatus: '{{OLDVALUE(status)}}',
        newStatus: '{{status}}'
      }
    }
  ]
}

// 定时清理过期数据
{
  name: 'cleanup_expired_data',
  label: '清理过期数据',
  object: 'temporary_data',
  triggerType: 'schedule',
  schedule: { cron: '0 2 * * *' },  // 每天凌晨2点
  conditions: { 
    field: 'expired_at', 
    operator: 'less_than', 
    value: 'NOW()' 
  },
  actions: [
    { type: 'delete_record' }
  ]
}
```

**示例**: 参考 `examples/crm/src/automation/workflows.ts`

---

#### 3.2 Flow (屏幕流程)
**协议位置**: `packages/spec/src/automation/flow.zod.ts`

**核心概念**: 可视化流程编排（类似 Power Automate）

**流程类型**:
- `autolaunched`: 后台流程
- `screen`: 带UI交互的流程
- `schedule`: 定时流程

**节点类型**:
- `start`: 开始节点
- `assignment`: 变量赋值
- `decision`: 条件分支
- `loop`: 循环
- `screen`: 屏幕交互
- `action`: 执行动作
- `subflow`: 子流程

**业务场景**:
```typescript
// 订单审批流程
{
  name: 'order_approval',
  label: '订单审批流程',
  type: 'screen',
  startNode: 'start',
  nodes: [
    { id: 'start', type: 'start' },
    {
      id: 'check_amount',
      type: 'decision',
      conditions: [
        {
          label: '大额订单',
          formula: 'amount > 100000',
          nextNode: 'manager_approval'
        },
        {
          label: '普通订单',
          formula: 'amount <= 100000',
          nextNode: 'auto_approve'
        }
      ]
    },
    {
      id: 'manager_approval',
      type: 'screen',
      screen: 'approval_form',
      nextNode: 'end'
    },
    {
      id: 'auto_approve',
      type: 'action',
      action: 'approve_order',
      nextNode: 'end'
    },
    { id: 'end', type: 'end' }
  ]
}
```

---

#### 3.3 Trigger (触发器注册)
**协议位置**: `packages/spec/src/automation/trigger-registry.zod.ts`

**核心概念**: 事件驱动的自动化触发器

**触发事件**:
- 数据变更: `record.created`, `record.updated`, `record.deleted`
- 时间事件: `schedule.daily`, `schedule.weekly`
- 用户事件: `user.login`, `user.logout`
- 系统事件: `system.startup`, `system.shutdown`

---

## 4️⃣ 权限与认证协议 (Auth & Permission)

### 🟢 P0 核心元数据

#### 4.1 Role (角色定义)
**协议位置**: `packages/spec/src/auth/role.zod.ts`

**核心概念**: 基于角色的访问控制 (RBAC)

**角色层级**:
```typescript
{
  name: 'sales_manager',
  label: '销售经理',
  description: '销售团队管理者',
  permissions: [
    'account.create',
    'account.read',
    'account.update',
    'account.delete',
    'opportunity.manage',
    'quote.approve'
  ]
}
```

---

#### 4.2 Permission (权限定义)
**协议位置**: `packages/spec/src/permission/permission.zod.ts`

**核心概念**: 对象级和字段级权限控制

**权限级别**:
```typescript
{
  object: 'account',
  permissions: {
    create: ['sales_rep', 'sales_manager'],
    read: ['sales_rep', 'sales_manager', 'customer_support'],
    update: ['sales_rep', 'sales_manager'],
    delete: ['sales_manager']
  },
  fieldPermissions: {
    annual_revenue: {
      read: ['sales_manager'],
      update: ['sales_manager']
    }
  }
}
```

---

#### 4.3 RLS (行级安全)
**协议位置**: `packages/spec/src/permission/rls.zod.ts`

**核心概念**: 记录级别的访问控制

**规则类型**:
```typescript
// 只能查看自己负责的客户
{
  object: 'account',
  rule: 'owner_id = $user.id',
  roles: ['sales_rep']
}

// 只能查看自己部门的数据
{
  object: 'project',
  rule: 'department_id = $user.department_id',
  roles: ['project_member']
}

// 经理可以查看团队所有数据
{
  object: 'account',
  rule: 'owner_id IN (SELECT id FROM users WHERE manager_id = $user.id)',
  roles: ['sales_manager']
}
```

**示例**: 参考 `examples/basic/auth-permission-example.ts`

---

### 🟡 P1 重要元数据

#### 4.4 Sharing (共享规则)
**协议位置**: `packages/spec/src/permission/sharing.zod.ts`

**核心概念**: 记录共享和协作

**共享类型**:
- `user`: 共享给特定用户
- `role`: 共享给角色
- `group`: 共享给群组
- `public`: 公开访问

```typescript
{
  record: 'account/A001',
  shareWith: {
    type: 'user',
    userId: 'U123',
    access: 'read_write'
  }
}
```

---

#### 4.5 Identity (身份认证)
**协议位置**: `packages/spec/src/auth/identity.zod.ts`

**核心概念**: 用户身份和会话管理

**支持的认证方式**:
- 用户名/密码
- OAuth 2.0 (Google, Microsoft, GitHub)
- SAML 2.0
- LDAP/Active Directory
- API Key

---

## 5️⃣ API协议 (API)

### 🟡 P1 重要元数据

#### 5.1 REST Server (REST API)
**协议位置**: `packages/spec/src/api/rest-server.zod.ts`

**核心概念**: RESTful API 自动生成

**API方法**:
```typescript
interface ApiMethods {
  create?: boolean;      // POST /api/objects/{object}
  read?: boolean;        // GET /api/objects/{object}/{id}
  update?: boolean;      // PATCH /api/objects/{object}/{id}
  delete?: boolean;      // DELETE /api/objects/{object}/{id}
  list?: boolean;        // GET /api/objects/{object}
  search?: boolean;      // POST /api/objects/{object}/search
  aggregate?: boolean;   // POST /api/objects/{object}/aggregate
  batch?: boolean;       // POST /api/batch
}
```

**端点配置**:
```typescript
{
  basePath: '/api/v1',
  objects: {
    account: {
      methods: ['create', 'read', 'update', 'delete', 'list', 'search']
    },
    opportunity: {
      methods: ['create', 'read', 'update', 'list']
    }
  }
}
```

**示例**: 参考 `examples/rest-server-example.ts`

---

#### 5.2 GraphQL (GraphQL API)
**协议位置**: `packages/spec/src/api/graphql.zod.ts`

**核心概念**: GraphQL Schema 自动生成

**Schema生成**:
```graphql
type Account {
  id: ID!
  name: String!
  industry: String
  annualRevenue: Float
  contacts: [Contact!]!
  opportunities: [Opportunity!]!
}

type Query {
  account(id: ID!): Account
  accounts(filter: AccountFilter, limit: Int, offset: Int): [Account!]!
}

type Mutation {
  createAccount(input: AccountInput!): Account!
  updateAccount(id: ID!, input: AccountInput!): Account!
  deleteAccount(id: ID!): Boolean!
}
```

**示例**: 参考 `examples/basic/api-protocols-example.ts`

---

#### 5.3 Batch (批量操作)
**协议位置**: `packages/spec/src/api/batch.zod.ts`

**核心概念**: 批量数据操作

**操作类型**:
```typescript
{
  operations: [
    {
      method: 'create',
      object: 'account',
      data: { name: '客户A', industry: 'IT' }
    },
    {
      method: 'update',
      object: 'account',
      id: 'A001',
      data: { status: 'active' }
    },
    {
      method: 'delete',
      object: 'account',
      id: 'A002'
    }
  ]
}
```

---

## 6️⃣ AI协议 (AI)

### 🔵 P2 扩展元数据

#### 6.1 Agent (AI代理)
**协议位置**: `packages/spec/src/ai/agent.zod.ts`

**核心概念**: AI助手和自动化代理

**代理定义**:
```typescript
{
  name: 'sales_assistant',
  label: '销售助手',
  role: 'sales_assistant',
  instructions: '你是一个专业的销售助手，帮助销售人员管理客户关系和销售机会。',
  tools: [
    'search_customers',
    'create_opportunity',
    'send_email'
  ],
  model: 'gpt-4',
  temperature: 0.7
}
```

**示例**: 参考 `examples/ai-sales/`, `examples/ai-support/`

---

#### 6.2 RAG Pipeline (检索增强生成)
**协议位置**: `packages/spec/src/ai/rag-pipeline.zod.ts`

**核心概念**: 基于企业知识库的AI问答

**RAG配置**:
```typescript
{
  name: 'customer_support_rag',
  label: '客服知识库',
  indexes: [
    {
      name: 'product_manual',
      source: { type: 'files', path: './docs/manuals' },
      embedding: { model: 'text-embedding-ada-002' }
    },
    {
      name: 'faq',
      source: { type: 'object', object: 'knowledge_article' },
      fields: ['title', 'content']
    }
  ],
  retrieval: {
    topK: 5,
    scoreThreshold: 0.7
  }
}
```

**示例**: 参考 `examples/ai-support/`, `examples/basic/ai-rag-example.ts`

---

#### 6.3 NLQ (自然语言查询)
**协议位置**: `packages/spec/src/ai/nlq.zod.ts`

**核心概念**: 自然语言转SQL查询

**使用场景**:
```typescript
// 用户输入: "显示本月新增的所有VIP客户"
// 系统转换为:
{
  object: 'account',
  filter: {
    and: [
      { field: 'is_vip', operator: 'equals', value: true },
      { field: 'created_at', operator: 'greater_than', value: 'MONTH_START()' }
    ]
  }
}
```

**示例**: 参考 `examples/ai-analyst/`

---

## 7️⃣ 系统协议 (System)

### 🟢 P0 核心元数据

#### 7.1 Manifest (包清单)
**协议位置**: `packages/spec/src/system/manifest.zod.ts`

**核心概念**: 应用或插件的元数据描述

**清单结构**:
```typescript
{
  id: 'com.acme.crm',
  type: 'app',
  name: 'crm',
  version: '1.0.0',
  displayName: 'ACME CRM',
  description: '客户关系管理系统',
  author: 'ACME Corp',
  license: 'MIT',
  dependencies: [
    { name: 'com.objectstack.driver.postgres', version: '^1.0.0' }
  ]
}
```

**示例**: 所有 `objectstack.config.ts` 文件

---

#### 7.2 Logging (日志)
**协议位置**: `packages/spec/src/system/logging.zod.ts`

**核心概念**: 结构化日志

**日志级别**: `trace`, `debug`, `info`, `warn`, `error`, `fatal`

---

#### 7.3 Events (事件总线)
**协议位置**: `packages/spec/src/system/events.zod.ts`

**核心概念**: 事件驱动架构

**事件类型**:
- 数据事件: `data.record.created`, `data.record.updated`
- 用户事件: `user.login`, `user.action`
- 系统事件: `system.startup`, `system.error`

---

### 🟡 P1 重要元数据

#### 7.4 Cache (缓存)
**协议位置**: `packages/spec/src/system/cache.zod.ts`

**核心概念**: 多级缓存

**缓存类型**:
- Memory: 内存缓存
- Redis: 分布式缓存
- CDN: 边缘缓存

---

#### 7.5 Audit (审计日志)
**协议位置**: `packages/spec/src/system/audit.zod.ts`

**核心概念**: 操作审计

**审计内容**:
- 谁 (Who): 用户ID
- 什么 (What): 操作类型
- 何时 (When): 时间戳
- 哪里 (Where): IP地址
- 为何 (Why): 变更原因

---

## 8️⃣ 集成协议 (Integration)

### 🔵 P2 扩展元数据

#### 8.1 Connector (连接器)
**协议位置**: `packages/spec/src/integration/connector.zod.ts`

**核心概念**: 外部系统集成

**连接器类型**:
- **Database**: PostgreSQL, MySQL, MongoDB
- **SaaS**: Salesforce, HubSpot, Stripe
- **File Storage**: S3, Azure Blob
- **Message Queue**: RabbitMQ, Kafka

**示例**: 参考 `examples/basic/integration-connectors-example.ts`

---

## 9️⃣ Hub协议 (Hub & Marketplace)

### 🔵 P2 扩展元数据

#### 9.1 Plugin Registry (插件注册)
**协议位置**: `packages/spec/src/hub/plugin-registry.zod.ts`

**核心概念**: 插件发布和发现

---

#### 9.2 Marketplace (应用市场)
**协议位置**: `packages/spec/src/hub/marketplace.zod.ts`

**核心概念**: 商业插件分发

---

#### 9.3 Tenant (多租户)
**协议位置**: `packages/spec/src/hub/tenant.zod.ts`

**核心概念**: SaaS多租户架构

**租户隔离**:
- 数据隔离
- Schema隔离
- 配置隔离

**示例**: 参考 `examples/basic/hub-marketplace-example.ts`

---

## 📊 业务开发优先级总结

### 快速上手路径 (1-2天)

**第一步: 数据建模**
1. 定义 Object (业务对象)
2. 定义 Field (字段)
3. 添加 Validation (验证规则)

**第二步: 界面构建**
1. 创建 View (列表/表单视图)
2. 配置 App (应用导航)
3. 添加 Action (自定义按钮)

**第三步: 权限控制**
1. 定义 Role (角色)
2. 配置 Permission (权限)
3. 设置 RLS (行级安全)

**示例**: 参考 `examples/todo/`, `examples/crm/`

---

### 进阶功能 (3-7天)

**自动化**:
- Workflow (工作流)
- Flow (屏幕流程)
- Hook (生命周期钩子)

**可视化**:
- Dashboard (仪表盘)
- Report (报表)
- Chart (图表)

**API**:
- REST Server (REST API)
- GraphQL (GraphQL API)
- Batch (批量操作)

**示例**: 参考 `examples/basic/`, `examples/plugin-advanced-crm/`

---

### 企业级功能 (1-2周)

**AI集成**:
- Agent (AI助手)
- RAG Pipeline (知识库)
- NLQ (自然语言查询)

**系统集成**:
- Connector (外部系统)
- ETL (数据同步)
- Webhook (事件通知)

**运维**:
- Logging (日志)
- Metrics (监控)
- Audit (审计)

**示例**: 参考 `examples/ai-*/`, `examples/basic/system-protocols-example.ts`

---

## 🔗 相关资源

### 核心文档
- [架构指南](./ARCHITECTURE.md)
- [协议快速参考](./PROTOCOL-QUICK-REFERENCE.md)
- [贡献指南](./CONTRIBUTING.md)

### 示例代码
- [完整示例目录](./examples/README.md)
- [CRM示例](./examples/crm/)
- [基础示例](./examples/basic/)

### 协议定义
- [Spec目录](./packages/spec/src/)
- [ObjectQL协议](./packages/spec/src/data/)
- [ObjectUI协议](./packages/spec/src/ui/)

---

**版本**: 1.0.0  
**最后更新**: 2026-01-31  
**维护者**: ObjectStack 核心团队  
**状态**: 持续更新
