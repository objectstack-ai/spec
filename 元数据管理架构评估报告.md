# ObjectStack å…ƒæ•°æ®åŠ è½½/ä¿å­˜åŠŸèƒ½åŒ…è¯„ä¼°æŠ¥å‘Š

**æ—¥æœŸ**: 2026å¹´1æœˆ31æ—¥  
**è¯„ä¼°å¯¹è±¡**: å…ƒæ•°æ®åŠ è½½/ä¿å­˜åŠŸèƒ½åº”è¯¥æ”¾åœ¨å“ªä¸ªè½¯ä»¶åŒ…ä¸­  
**è¯„ä¼°æ–¹æ³•**: å…¨é¢æ‰«æç³»ç»Ÿç°æœ‰è½¯ä»¶åŒ…ã€åè®®å’Œå¾®å†…æ ¸æ¶æ„

---

## ä¸€ã€æ‰§è¡Œæ‘˜è¦ (Executive Summary)

ç»è¿‡å¯¹ObjectStackå¾®å†…æ ¸æ¶æ„çš„å…¨é¢åˆ†æï¼Œ**å»ºè®®åˆ›å»ºæ–°çš„ç‹¬ç«‹åŒ… `@objectstack/metadata`ï¼ˆLayer 3ï¼‰**ï¼Œä¸“é—¨è´Ÿè´£å…ƒæ•°æ®çš„åŠ è½½ã€ä¿å­˜ã€åºåˆ—åŒ–å’ŒæŒä¹…åŒ–æ“ä½œã€‚

è¿™ä¸ªå†³ç­–åŸºäºä»¥ä¸‹å…³é”®å› ç´ ï¼š
- âœ… ç¬¦åˆå¾®å†…æ ¸æ¶æ„çš„å…³æ³¨ç‚¹åˆ†ç¦»åŸåˆ™
- âœ… é¿å…è¿åç°æœ‰åŒ…çš„å•ä¸€èŒè´£åŸåˆ™
- âœ… ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•æä¾›æ¸…æ™°çš„åŸºç¡€
- âœ… ä¿æŒå‘åå…¼å®¹æ€§ï¼Œæ”¯æŒæ¸è¿›å¼è¿ç§»

---

## äºŒã€ç°çŠ¶åˆ†æ (Current State Analysis)

### 2.1 ç°æœ‰è½¯ä»¶åŒ…ç»“æ„

ObjectStacké‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œå…±6å±‚ï¼š

| å±‚çº§ | åŒ…å | èŒè´£ |
|-----|------|-----|
| Layer 0 | @objectstack/spec | åè®®å®šä¹‰ï¼ˆZod schemasï¼‰ |
| Layer 1 | @objectstack/types | å…±äº«ç±»å‹å®šä¹‰ |
| Layer 2 | @objectstack/core | å¾®å†…æ ¸ï¼ˆæ’ä»¶ç”Ÿå‘½å‘¨æœŸã€æœåŠ¡æ³¨å†Œï¼‰ |
| Layer 3 | @objectstack/objectql | æŸ¥è¯¢å¼•æ“ï¼ˆå†…å­˜æ³¨å†Œè¡¨ï¼‰ |
| Layer 3 | @objectstack/runtime | è¿è¡Œæ—¶å·¥å…·ï¼ˆæ’ä»¶åŒ…è£…å™¨ï¼‰ |
| Layer 4 | @objectstack/client | å®¢æˆ·ç«¯SDK |
| Layer 4 | @objectstack/client-react | Reacté›†æˆ |
| Layer 5 | @objectstack/driver-* | é©±åŠ¨æ’ä»¶ |
| Layer 6 | @objectstack/cli | å‘½ä»¤è¡Œå·¥å…· |

### 2.2 ç°æœ‰å…ƒæ•°æ®ç›¸å…³ç»„ä»¶

å½“å‰å…ƒæ•°æ®åŠŸèƒ½åˆ†æ•£åœ¨å¤šä¸ªåŒ…ä¸­ï¼š

1. **SchemaRegistry** (`@objectstack/objectql`)
   - ä½ç½®ï¼š`packages/objectql/src/registry.ts`
   - åŠŸèƒ½ï¼šå†…å­˜ä¸­çš„å…ƒæ•°æ®æ³¨å†Œè¡¨
   - é™åˆ¶ï¼šä»…æ”¯æŒè¿è¡Œæ—¶å­˜å‚¨ï¼Œæ— æŒä¹…åŒ–èƒ½åŠ›

2. **AppPlugin/DriverPlugin** (`@objectstack/runtime`)
   - ä½ç½®ï¼š`packages/runtime/src/app-plugin.ts`
   - åŠŸèƒ½ï¼šåŠ è½½åº”ç”¨æ¸…å•å¹¶æ³¨å†Œä¸ºæœåŠ¡
   - é™åˆ¶ï¼šä»…å¤„ç†æ¸…å•åŠ è½½ï¼Œæ— é€šç”¨åŒ–

3. **Metadata Hooks** (`@objectstack/client-react`)
   - ä½ç½®ï¼š`packages/client-react/src/metadata-hooks.tsx`
   - åŠŸèƒ½ï¼šå®¢æˆ·ç«¯è·å–å…ƒæ•°æ®ï¼ˆuseObject, useViewï¼‰
   - é™åˆ¶ï¼šä»…å®¢æˆ·ç«¯ï¼Œä¾èµ–HTTP API

4. **Hub/Composeråè®®** (`@objectstack/spec/hub`)
   - ä½ç½®ï¼š`packages/spec/src/hub/composer.zod.ts`
   - åŠŸèƒ½ï¼šäº‘ç«¯æ¸…å•ç¼–æ’å’Œç»„åˆ
   - é™åˆ¶ï¼šä»…åè®®å®šä¹‰ï¼Œæ— å®ç°

### 2.3 å­˜åœ¨çš„é—®é¢˜

1. **èŒè´£åˆ†æ•£**ï¼šå…ƒæ•°æ®I/Oé€»è¾‘æ•£è½åœ¨å¤šä¸ªåŒ…ä¸­
2. **ç¼ºä¹ç»Ÿä¸€æ¥å£**ï¼šæ²¡æœ‰æ ‡å‡†çš„åŠ è½½/ä¿å­˜API
3. **é‡å¤ä»£ç **ï¼šåºåˆ—åŒ–é€»è¾‘å¯èƒ½åœ¨å¤šå¤„é‡å¤
4. **æ‰©å±•å›°éš¾**ï¼šæ·»åŠ æ–°æ ¼å¼ï¼ˆYAML, TypeScriptï¼‰éœ€è¦æ”¹å¤šå¤„
5. **ç¼ºä¹æŒä¹…åŒ–**ï¼šSchemaRegistryåªåœ¨å†…å­˜ä¸­ï¼Œæ— æ³•ä¿å­˜åˆ°ç£ç›˜

---

## ä¸‰ã€å€™é€‰æ–¹æ¡ˆè¯„ä¼° (Options Evaluation)

### æ–¹æ¡ˆAï¼šæ”¾å…¥ @objectstack/spec âŒ

**ç†ç”±æ‹’ç»ï¼š**
- SpecåŒ…çš„æ ¸å¿ƒçº¦æŸæ˜¯"é›¶è¿è¡Œæ—¶ä¾èµ–ï¼ˆé™¤Zodå¤–ï¼‰"
- æ·»åŠ I/OåŠŸèƒ½éœ€è¦å¼•å…¥ `fs`, `glob`, `js-yaml` ç­‰ä¾èµ–
- è¿åäº†"åè®®å®šä¹‰ä¸å®ç°åˆ†ç¦»"çš„åŸåˆ™
- Specåº”è¯¥å®šä¹‰"æ˜¯ä»€ä¹ˆ"ï¼Œè€Œä¸æ˜¯"æ€ä¹ˆåš"

**å½±å“ï¼š**
- ç ´ååŒ…çš„çº¯å‡€æ€§
- å¢åŠ ä¸å¿…è¦çš„ä¾èµ–
- æ··æ·†åè®®å±‚å’Œå®ç°å±‚

### æ–¹æ¡ˆBï¼šæ”¾å…¥ @objectstack/core âŒ

**ç†ç”±æ‹’ç»ï¼š**
- Coreæ˜¯æœ€å°åŒ–å¾®å†…æ ¸ï¼Œåªè´Ÿè´£æ’ä»¶ç”Ÿå‘½å‘¨æœŸå’ŒæœåŠ¡æ³¨å†Œ
- æ·»åŠ å…ƒæ•°æ®I/Oæ˜¯ç‰¹å®šé¢†åŸŸé€»è¾‘ï¼Œä¼šè†¨èƒ€å†…æ ¸
- è¿å"å¾®å†…æ ¸åº”è¯¥ä¿æŒæœ€å°"çš„è®¾è®¡åŸåˆ™
- å†…æ ¸åº”è¯¥å¯¹é¢†åŸŸé€»è¾‘ä¿æŒæ— çŸ¥

**å½±å“ï¼š**
- è¿èƒŒå¾®å†…æ ¸æ¶æ„è®¾è®¡
- å¢åŠ å†…æ ¸å¤æ‚åº¦
- é™ä½å†…æ ¸ç¨³å®šæ€§

### æ–¹æ¡ˆCï¼šæ”¾å…¥ @objectstack/objectql âŒ

**ç†ç”±æ‹’ç»ï¼š**
- ObjectQLä¸“æ³¨äºæŸ¥è¯¢æ‰§è¡Œå’Œé©±åŠ¨ç®¡ç†
- å½“å‰çš„SchemaRegistryåªæ˜¯å†…å­˜å­˜å‚¨
- æ·»åŠ æŒä¹…åŒ–ä¼šè¿å"å•ä¸€èŒè´£åŸåˆ™"
- ObjectQLå±‚ä¸åº”è¯¥çŸ¥é“æ–‡ä»¶ç³»ç»Ÿå’Œåºåˆ—åŒ–æ ¼å¼

**å½±å“ï¼š**
- æ··æ·†æŸ¥è¯¢å¼•æ“å’Œå…ƒæ•°æ®ç®¡ç†çš„èŒè´£
- ObjectQLå˜å¾—è‡ƒè‚¿
- éš¾ä»¥ç‹¬ç«‹æµ‹è¯•å’Œç»´æŠ¤

### æ–¹æ¡ˆDï¼šæ”¾å…¥ @objectstack/runtime âŒ

**ç†ç”±æ‹’ç»ï¼š**
- Runtimeå·²ç»æ˜¯ä¸€ä¸ª"ä¸‡é‡‘æ²¹"åŒ…ï¼ŒèŒè´£ä¸å¤Ÿæ¸…æ™°
- æ·»åŠ æ›´å¤šåŠŸèƒ½ä¼šä½¿è¾¹ç•Œæ›´åŠ æ¨¡ç³Š
- Runtimeåº”è¯¥ä¸“æ³¨äºæ’ä»¶åŒ…è£…å’ŒHTTPå·¥å…·
- æ··åˆI/Oé€»è¾‘ä¼šå¯¼è‡´åŒ…å¤±å»ç„¦ç‚¹

**å½±å“ï¼š**
- è¿›ä¸€æ­¥æ¨¡ç³ŠåŒ…çš„èŒè´£
- å¢åŠ ç»´æŠ¤å¤æ‚åº¦
- ä¸ç¬¦åˆæ¸…æ™°æ¶æ„åŸåˆ™

### æ–¹æ¡ˆEï¼šæ”¾å…¥ @objectstack/cli âŒ

**ç†ç”±æ‹’ç»ï¼š**
- CLIæ˜¯Layer 6çš„ç‹¬ç«‹å·¥å…·
- æœåŠ¡å™¨è¿è¡Œæ—¶ä¸åº”è¯¥ä¾èµ–CLIå·¥å…·
- åˆ›å»ºäº†ä¸åˆç†çš„å‘ä¸Šä¾èµ–
- CLIåº”è¯¥ä½¿ç”¨åº•å±‚åº“ï¼Œè€Œä¸æ˜¯è¢«åº•å±‚ä½¿ç”¨

**å½±å“ï¼š**
- ç ´åä¾èµ–å±‚æ¬¡
- æ— æ³•åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨
- è¿åä¾èµ–å€’ç½®åŸåˆ™

---

## å››ã€æ¨èæ–¹æ¡ˆ (Recommended Solution)

### âœ… æ–¹æ¡ˆFï¼šåˆ›å»ºæ–°åŒ… @objectstack/metadata (Layer 3)

#### 4.1 æ ¸å¿ƒä¼˜åŠ¿

1. **æ¸…æ™°çš„èŒè´£è¾¹ç•Œ**
   - ä¸“æ³¨äºå…ƒæ•°æ®çš„åºåˆ—åŒ–ã€ååºåˆ—åŒ–å’ŒæŒä¹…åŒ–
   - ä¸æ¶‰åŠæŸ¥è¯¢æ‰§è¡Œï¼ˆObjectQLçš„èŒè´£ï¼‰
   - ä¸æ¶‰åŠæ’ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆCoreçš„èŒè´£ï¼‰

2. **ç¬¦åˆå¾®å†…æ ¸åŸåˆ™**
   - ä½œä¸ºå¯é€‰çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œä¸å½±å“å†…æ ¸
   - é€šè¿‡æœåŠ¡æ³¨å†Œè¿›è¡Œé›†æˆ
   - å¯ä»¥è¢«å…¶ä»–åŒ…ä¾èµ–å’Œä½¿ç”¨

3. **æ˜“äºæ‰©å±•**
   - æ·»åŠ æ–°çš„åºåˆ—åŒ–æ ¼å¼ï¼ˆXML, TOMLï¼‰åªéœ€å®ç°æ¥å£
   - æ·»åŠ æ–°çš„åŠ è½½å™¨ï¼ˆHTTP, S3, Databaseï¼‰åªéœ€æ·»åŠ æ’ä»¶
   - æ”¯æŒè‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥

4. **å‘åå…¼å®¹**
   - ä¸ç ´åç°æœ‰ä»£ç 
   - SchemaRegistryå¯ä»¥ç»§ç»­ä½¿ç”¨
   - æä¾›æ¡¥æ¥æ–¹æ¡ˆå®ç°åŒå‘åŒæ­¥

#### 4.2 åŒ…çš„æ ¸å¿ƒèŒè´£

```typescript
// 1. å…ƒæ•°æ®åºåˆ—åŒ–/ååºåˆ—åŒ–
interface MetadataSerializer {
  serialize<T>(item: T, options?: SerializeOptions): string;
  deserialize<T>(content: string, schema?: ZodSchema): T;
}

// 2. æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
interface MetadataLoader {
  load<T>(type: string, name: string): Promise<T | null>;
  save<T>(type: string, name: string, data: T): Promise<SaveResult>;
  watch(type: string, callback: WatchCallback): void;
}

// 3. ç¼“å­˜ç®¡ç†
interface MetadataCache {
  get<T>(key: string): Promise<T | null>;
  set<T>(key: string, value: T, ttl?: number): Promise<void>;
  invalidate(key: string): Promise<void>;
}

// 4. å¯¼å…¥/å¯¼å‡º
interface MetadataExporter {
  exportCollection(type: string, options: ExportOptions): Promise<void>;
  importCollection(path: string, options: ImportOptions): Promise<void>;
}

// 5. éªŒè¯
interface MetadataValidator {
  validate<T>(data: T, schema: ZodSchema): ValidationResult;
  migrate(data: any, fromVersion: string, toVersion: string): any;
}
```

#### 4.3 æ”¯æŒçš„åŠŸèƒ½

| åŠŸèƒ½ç±»åˆ« | å…·ä½“åŠŸèƒ½ |
|---------|---------|
| **æ ¼å¼æ”¯æŒ** | JSON, YAML, TypeScript, JavaScript |
| **åŠ è½½ç­–ç•¥** | æ–‡ä»¶ç³»ç»Ÿ, HTTP, S3, æ•°æ®åº“ï¼ˆæ‰©å±•ï¼‰ |
| **ç¼“å­˜ç­–ç•¥** | ETag, å†…å­˜ç¼“å­˜, Redisï¼ˆæ‰©å±•ï¼‰ |
| **æ–‡ä»¶ç›‘å¬** | å¼€å‘æ¨¡å¼çƒ­é‡è½½ |
| **éªŒè¯** | Zod schemaéªŒè¯, ç‰ˆæœ¬è¿ç§» |
| **å¯¼å…¥å¯¼å‡º** | æ‰¹é‡æ“ä½œ, å†²çªè§£å†³ |
| **æ³¨å†Œè¡¨é›†æˆ** | ä¸SchemaRegistryåŒå‘åŒæ­¥ |

#### 4.4 ä¾èµ–å…³ç³»

```
@objectstack/metadata
â”œâ”€â”€ ç›´æ¥ä¾èµ–ï¼š
â”‚   â”œâ”€â”€ @objectstack/spec        # ä½¿ç”¨Zod schemaséªŒè¯
â”‚   â”œâ”€â”€ @objectstack/core        # æ—¥å¿—ã€æœåŠ¡æ³¨å†Œ
â”‚   â”œâ”€â”€ @objectstack/types       # å…±äº«ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ glob                      # æ–‡ä»¶åŒ¹é…
â”‚   â”œâ”€â”€ js-yaml                   # YAMLè§£æ
â”‚   â””â”€â”€ chokidar (å¯é€‰)           # æ–‡ä»¶ç›‘å¬
â”‚
â””â”€â”€ è¢«ä»¥ä¸‹åŒ…ä½¿ç”¨ï¼š
    â”œâ”€â”€ @objectstack/cli          # ä»£ç ç”Ÿæˆã€scaffolding
    â”œâ”€â”€ @objectstack/runtime      # å¯åŠ¨æ—¶åŠ è½½æ¸…å•
    â”œâ”€â”€ @objectstack/objectql     # æ³¨å†Œè¡¨æŒä¹…åŒ–
    â””â”€â”€ æœªæ¥ï¼š@objectstack/hub    # äº‘ç«¯å…ƒæ•°æ®åŒæ­¥
```

#### 4.5 åŒ…ç»“æ„

```
packages/metadata/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ loaders/
â”‚   â”‚   â”œâ”€â”€ filesystem-loader.ts       # ä»ç£ç›˜åŠ è½½
â”‚   â”‚   â”œâ”€â”€ http-loader.ts             # ä»HTTP/S3åŠ è½½
â”‚   â”‚   â”œâ”€â”€ loader-interface.ts        # åŠ è½½å™¨æŠ½è±¡æ¥å£
â”‚   â”‚   â””â”€â”€ composite-loader.ts        # ç»„åˆå¤šä¸ªåŠ è½½å™¨
â”‚   â”œâ”€â”€ serializers/
â”‚   â”‚   â”œâ”€â”€ json-serializer.ts         # JSONæ ¼å¼
â”‚   â”‚   â”œâ”€â”€ yaml-serializer.ts         # YAMLæ ¼å¼
â”‚   â”‚   â”œâ”€â”€ typescript-serializer.ts   # TypeScriptæ¨¡å—æ ¼å¼
â”‚   â”‚   â””â”€â”€ serializer-interface.ts    # åºåˆ—åŒ–å™¨æŠ½è±¡æ¥å£
â”‚   â”œâ”€â”€ validators/
â”‚   â”‚   â”œâ”€â”€ schema-validator.ts        # ZodéªŒè¯
â”‚   â”‚   â”œâ”€â”€ migration-validator.ts     # ç‰ˆæœ¬è¿ç§»
â”‚   â”‚   â””â”€â”€ validator-interface.ts     # éªŒè¯å™¨æ¥å£
â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â”œâ”€â”€ etag-cache.ts              # ETagç¼“å­˜
â”‚   â”‚   â”œâ”€â”€ memory-cache.ts            # å†…å­˜ç¼“å­˜
â”‚   â”‚   â””â”€â”€ cache-interface.ts         # ç¼“å­˜æ¥å£
â”‚   â”œâ”€â”€ registry-bridge/
â”‚   â”‚   â”œâ”€â”€ schema-registry-sync.ts    # SchemaRegistryåŒæ­¥
â”‚   â”‚   â””â”€â”€ event-emitter.ts           # å˜æ›´é€šçŸ¥
â”‚   â”œâ”€â”€ exporters/
â”‚   â”‚   â”œâ”€â”€ collection-exporter.ts     # æ‰¹é‡å¯¼å‡º
â”‚   â”‚   â””â”€â”€ selective-exporter.ts      # è¿‡æ»¤å¯¼å‡º
â”‚   â”œâ”€â”€ importers/
â”‚   â”‚   â”œâ”€â”€ collection-importer.ts     # æ‰¹é‡å¯¼å…¥
â”‚   â”‚   â””â”€â”€ conflict-resolver.ts       # å†²çªè§£å†³
â”‚   â”œâ”€â”€ metadata-manager.ts            # ä¸»ç¼–æ’å™¨
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

---

## äº”ã€å®æ–½è®¡åˆ’ (Implementation Plan)

### é˜¶æ®µ1ï¼šåŸºç¡€è®¾æ–½ (ç¬¬1å‘¨)
- [ ] åˆ›å»ºåŒ…ç»“æ„å’Œé…ç½®
- [ ] å®ç°æ ¸å¿ƒæ¥å£å®šä¹‰
- [ ] å®ç°æ–‡ä»¶ç³»ç»ŸåŠ è½½å™¨
- [ ] å®ç°JSON/YAMLåºåˆ—åŒ–å™¨
- [ ] æ·»åŠ ZodéªŒè¯é›†æˆ
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

### é˜¶æ®µ2ï¼šé«˜çº§åŠŸèƒ½ (ç¬¬2å‘¨)
- [ ] æ·»åŠ TypeScript/JavaScriptåºåˆ—åŒ–å™¨
- [ ] å®ç°ETagç¼“å­˜æœºåˆ¶
- [ ] æ·»åŠ æ–‡ä»¶ç›‘å¬ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
- [ ] å®ç°å¯¼å‡º/å¯¼å…¥å·¥å…·
- [ ] é›†æˆæµ‹è¯•

### é˜¶æ®µ3ï¼šé›†æˆ (ç¬¬3å‘¨)
- [ ] åˆ›å»ºSchemaRegistryæŒä¹…åŒ–æ¡¥æ¥
- [ ] æ›´æ–°Runtimeä½¿ç”¨metadata manager
- [ ] é›†æˆåˆ°CLIå‘½ä»¤
- [ ] æ·»åŠ HTTPåŠ è½½å™¨ï¼ˆäº‘åŒæ­¥ï¼‰
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

### é˜¶æ®µ4ï¼šæ–‡æ¡£ä¸ä¼˜åŒ– (ç¬¬4å‘¨)
- [ ] å®Œæ•´APIæ–‡æ¡£
- [ ] ä½¿ç”¨æŒ‡å—å’Œç¤ºä¾‹
- [ ] æ›´æ–°ARCHITECTURE.md
- [ ] æ›´æ–°PACKAGE-DEPENDENCIES.md
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œä¼˜åŒ–

---

## å…­ã€ä½¿ç”¨ç¤ºä¾‹ (Usage Examples)

### 6.1 åŸºæœ¬ä½¿ç”¨

```typescript
import { MetadataManager } from '@objectstack/metadata';
import { ServiceObject } from '@objectstack/spec/data';

// åˆ›å»ºç®¡ç†å™¨
const manager = new MetadataManager({
  rootDir: './metadata',
  formats: ['typescript', 'json', 'yaml'],
  cache: { enabled: true, ttl: 3600 },
  watch: process.env.NODE_ENV === 'development',
});

// åŠ è½½å…ƒæ•°æ®
const customer = await manager.load<ServiceObject>('object', 'customer');

// ä¿å­˜å…ƒæ•°æ®
await manager.save('object', 'project', projectObject, {
  format: 'typescript',
  prettify: true,
});

// æ‰¹é‡åŠ è½½
const objects = await manager.loadCollection<ServiceObject>('object', {
  patterns: ['**/*.object.ts', '**/*.object.json'],
});
```

### 6.2 ä¸SchemaRegistryé›†æˆ

```typescript
import { SchemaRegistry } from '@objectstack/objectql';
import { SchemaRegistryPersistence } from '@objectstack/metadata';

const persistence = new SchemaRegistryPersistence(
  SchemaRegistry,
  manager
);

// ä»ç£ç›˜åŠ è½½æ‰€æœ‰å¯¹è±¡åˆ°æ³¨å†Œè¡¨
await persistence.loadAll();

// ä¿å­˜æ³¨å†Œè¡¨åˆ°ç£ç›˜
await persistence.saveAll();

// å¯ç”¨è‡ªåŠ¨åŒæ­¥ï¼ˆæ–‡ä»¶å˜æ›´è‡ªåŠ¨æ›´æ–°æ³¨å†Œè¡¨ï¼‰
persistence.enableAutoSync();
```

### 6.3 CLIé›†æˆ

```typescript
// CLIå‘½ä»¤: objectstack generate object
import { MetadataManager } from '@objectstack/metadata';

export async function generateObject(name: string, options: any) {
  const manager = new MetadataManager({ rootDir: './src/objects' });
  
  const object: ServiceObject = {
    name,
    label: options.label || name,
    fields: {
      name: { type: 'text', label: 'Name' },
    },
  };
  
  await manager.save('object', name, object, {
    format: 'typescript',
  });
  
  console.log(`âœ“ Created ${name}.object.ts`);
}
```

---

## ä¸ƒã€å½±å“åˆ†æ (Impact Analysis)

### 7.1 ç§¯æå½±å“

| æ–¹é¢ | å½±å“ |
|------|------|
| **æ¶æ„æ¸…æ™°åº¦** | â†‘â†‘ èŒè´£æ˜ç¡®ï¼Œè¾¹ç•Œæ¸…æ™° |
| **å¯ç»´æŠ¤æ€§** | â†‘â†‘ ç‹¬ç«‹åŒ…ï¼Œæ˜“äºç»´æŠ¤ |
| **å¯æ‰©å±•æ€§** | â†‘â†‘ æ’ä»¶åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±• |
| **å¯æµ‹è¯•æ€§** | â†‘â†‘ ç‹¬ç«‹æµ‹è¯•ï¼Œæ˜“äºmock |
| **å¼€å‘ä½“éªŒ** | â†‘ ç»Ÿä¸€APIï¼Œå‡å°‘å­¦ä¹ æˆæœ¬ |
| **æ€§èƒ½** | â†‘ ç¼“å­˜ä¼˜åŒ–ï¼Œå‡å°‘I/O |

### 7.2 æ½œåœ¨é£é™©

| é£é™© | ä¸¥é‡åº¦ | ç¼“è§£æªæ–½ |
|------|--------|---------|
| **åŒ…æ•°é‡å¢åŠ ** | ä½ | èŒè´£æ¸…æ™°å¯æŠµæ¶ˆå¤æ‚åº¦ |
| **æ€§èƒ½å¼€é”€** | ä½ | å®æ–½ç¼“å­˜å’Œæ‡’åŠ è½½ |
| **è¿ç§»æˆæœ¬** | ä¸­ | æä¾›å‘åå…¼å®¹å’Œè¿ç§»æŒ‡å— |
| **é‡‡ç”¨é˜»åŠ›** | ä½ | å¯é€‰ä½¿ç”¨ï¼Œæ¸è¿›è¿ç§» |

### 7.3 å‘åå…¼å®¹æ€§

- âœ… **ä¸ç ´åç°æœ‰ä»£ç **ï¼šSchemaRegistryç»§ç»­å·¥ä½œ
- âœ… **å¯é€‰é‡‡ç”¨**ï¼šå„åŒ…å¯ä»¥é€æ­¥è¿ç§»
- âœ… **å…±å­˜æ”¯æŒ**ï¼šæ–°æ—§æ–¹æ¡ˆå¯ä»¥å¹¶å­˜
- âœ… **æ¸è¿›å¼è¿ç§»**ï¼šæä¾›è¿ç§»è·¯å¾„å’Œå·¥å…·

---

## å…«ã€åè®®å®šä¹‰ (Protocol Definition)

å·²åœ¨ `@objectstack/spec` ä¸­å®šä¹‰å…ƒæ•°æ®åŠ è½½å™¨åè®®ï¼š

**æ–‡ä»¶ä½ç½®ï¼š** `packages/spec/src/system/metadata-loader.zod.ts`

**ä¸»è¦åè®®ï¼š**
- `MetadataFormat` - æ”¯æŒçš„æ ¼å¼æšä¸¾
- `MetadataStats` - å…ƒæ•°æ®ç»Ÿè®¡ä¿¡æ¯
- `MetadataLoadOptions` - åŠ è½½é€‰é¡¹
- `MetadataSaveOptions` - ä¿å­˜é€‰é¡¹
- `MetadataExportOptions` - å¯¼å‡ºé€‰é¡¹
- `MetadataImportOptions` - å¯¼å…¥é€‰é¡¹
- `MetadataLoaderContract` - åŠ è½½å™¨æ¥å£å¥‘çº¦
- `MetadataManagerConfig` - ç®¡ç†å™¨é…ç½®

æ‰€æœ‰åè®®ä½¿ç”¨Zodå®šä¹‰ï¼Œæ”¯æŒï¼š
- è¿è¡Œæ—¶éªŒè¯
- TypeScriptç±»å‹æ¨å¯¼
- JSON Schemaç”Ÿæˆ

---

## ä¹ã€ç»“è®ºä¸å»ºè®® (Conclusion & Recommendations)

### 9.1 æ ¸å¿ƒç»“è®º

ç»è¿‡å…¨é¢è¯„ä¼°ï¼Œ**å¼ºçƒˆå»ºè®®åˆ›å»ºç‹¬ç«‹çš„ `@objectstack/metadata` åŒ…ï¼ˆLayer 3ï¼‰**ï¼ŒåŸå› å¦‚ä¸‹ï¼š

1. âœ… **ç¬¦åˆå¾®å†…æ ¸æ¶æ„åŸåˆ™** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»
2. âœ… **ä¸ç ´åç°æœ‰åŒ…çš„è¾¹ç•Œ** - å„åŒ…ä¿æŒå•ä¸€èŒè´£
3. âœ… **ä¸ºæœªæ¥æ‰©å±•å¥ å®šåŸºç¡€** - äº‘åŒæ­¥ã€ç‰ˆæœ¬æ§åˆ¶ã€å¤šç§Ÿæˆ·
4. âœ… **æå‡å¼€å‘ä½“éªŒ** - ç»Ÿä¸€çš„APIå’Œæ¸…æ™°çš„æ–‡æ¡£
5. âœ… **ä¿æŒå‘åå…¼å®¹** - æ¸è¿›å¼è¿ç§»ï¼Œä¸ç ´åç°æœ‰ä»£ç 

### 9.2 ç«‹å³è¡ŒåŠ¨å»ºè®®

1. **å®¡æ‰¹æ–¹æ¡ˆ** - ä¸å›¢é˜Ÿè®¨è®ºå¹¶ç¡®è®¤æ¶æ„å†³ç­–
2. **åˆ›å»ºåŒ…ç»“æ„** - æŒ‰ç…§å®æ–½è®¡åˆ’Phase 1å¼€å§‹
3. **æ›´æ–°æ–‡æ¡£** - ç¡®ä¿æ¶æ„æ–‡æ¡£åŒæ­¥æ›´æ–°
4. **æ¸è¿›å®æ–½** - å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†æ‰©å±•é«˜çº§åŠŸèƒ½

### 9.3 é•¿æœŸä»·å€¼

è¿™ä¸ªæ–°åŒ…å°†æˆä¸ºObjectStackå…ƒæ•°æ®ç®¡ç†çš„åŸºçŸ³ï¼Œæ”¯æŒï¼š
- ğŸ“¦ **æ’ä»¶ç”Ÿæ€** - ç»Ÿä¸€çš„å…ƒæ•°æ®åŠ è½½æ ‡å‡†
- â˜ï¸ **äº‘ç«¯åŒæ­¥** - Hub/Composeré›†æˆ
- ğŸ”„ **ç‰ˆæœ¬æ§åˆ¶** - å…ƒæ•°æ®ç‰ˆæœ¬ç®¡ç†å’Œè¿ç§»
- ğŸ¢ **å¤šç§Ÿæˆ·** - ç§Ÿæˆ·çº§åˆ«çš„å…ƒæ•°æ®éš”ç¦»
- ğŸ”Œ **æ‰©å±•æ€§** - è‡ªå®šä¹‰åŠ è½½å™¨å’Œåºåˆ—åŒ–å™¨

---

## åã€é™„å½• (Appendix)

### A. ç›¸å…³æ–‡æ¡£é“¾æ¥

- [å®Œæ•´æ¶æ„æ–‡æ¡£](content/docs/developers/metadata-management.mdx)
- [å…ƒæ•°æ®åŠ è½½å™¨åè®®](packages/spec/src/system/metadata-loader.zod.ts)
- [åè®®æµ‹è¯•](packages/spec/src/system/metadata-loader.test.ts)
- [ARCHITECTURE.md](ARCHITECTURE.md)
- [PACKAGE-DEPENDENCIES.md](PACKAGE-DEPENDENCIES.md)

### B. æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| Zod | Schemaå®šä¹‰å’ŒéªŒè¯ |
| glob | æ–‡ä»¶æ¨¡å¼åŒ¹é… |
| js-yaml | YAMLè§£æ |
| chokidar | æ–‡ä»¶ç›‘å¬ |
| TypeScript | ç±»å‹ç³»ç»Ÿ |

### C. å‚è€ƒæ¶æ„

å€Ÿé‰´äº†ä»¥ä¸‹ä¼˜ç§€æ¶æ„ï¼š
- **Kubernetes** - CRD (Custom Resource Definitions)
- **VS Code** - Extension API
- **OSGi** - æ¨¡å—åŒ–å’Œæ’ä»¶ç³»ç»Ÿ
- **Eclipse** - Plugin Architecture

---

**è¯„ä¼°å®Œæˆæ—¶é—´**: 2026-01-31  
**ä¸‹æ¬¡è¯„å®¡**: Phase 1 å®æ–½å  
**çŠ¶æ€**: âœ… å»ºè®®å·²æäº¤ï¼Œç­‰å¾…å®¡æ‰¹
