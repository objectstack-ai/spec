---
title: Client SDK
description: The official TypeScript client for ObjectStack — auto-discovery, typed metadata, CRUD, batch operations, and service-aware feature detection.
---

# Client SDK

The `@objectstack/client` is the official TypeScript client for ObjectStack. It provides a typed, protocol-aware interface that automatically adapts to your server's available services.

## Features

- **Auto-Discovery**: Connects to your ObjectStack server and discovers available services, routes, and capabilities
- **Service-Aware**: Checks `discovery.services` to determine which features are available before calling them
- **Typed Metadata**: Retrieve Object and View definitions with full type support
- **Metadata Caching**: ETag-based conditional requests for efficient metadata caching
- **Unified Data Access**: Simple CRUD operations for any object in your schema
- **Batch Operations**: Efficient bulk create/update/upsert/delete with transaction support
- **Query Builder**: Programmatic query construction with `createQuery()` and `createFilter()`
- **Standardized Errors**: Machine-readable error codes with retry guidance

## Installation

```bash
pnpm add @objectstack/client
```

## Quick Start

```typescript
import { ObjectStackClient } from '@objectstack/client';

const client = new ObjectStackClient({
  baseUrl: 'http://localhost:3004',
});

async function main() {
  // 1. Connect — fetches discovery manifest
  await client.connect();

  // 2. Check available services
  console.log('Services:', client.discovery?.services);
  // → { metadata: { enabled: true, status: 'degraded' }, data: { enabled: true, status: 'available' }, auth: { enabled: false, ... } }

  // 3. Query data
  const tasks = await client.data.find('todo_task', {
    select: ['subject', 'priority'],
    filters: ['priority', '>=', 2],
    sort: ['-priority'],
    top: 10
  });

  // 4. Create a record
  const newTask = await client.data.create('todo_task', {
    subject: 'New Task',
    priority: 1
  });

  // 5. Batch operations
  const result = await client.data.batch('todo_task', {
    operation: 'update',
    records: [
      { id: '1', data: { status: 'active' } },
      { id: '2', data: { status: 'active' } }
    ],
    options: { atomic: true, returnRecords: true }
  });
  console.log(`Updated ${result.succeeded} records`);
}
```

---

## Auto-Discovery

When you call `client.connect()`, the client:

1. Fetches `/.well-known/objectstack` (or falls back to `/api/v1`)
2. Parses the discovery response including `routes`, `features`, and `services`
3. Configures all API route paths dynamically

```typescript
await client.connect();

// Discovery result is available
const discovery = client.discovery;
console.log(discovery.version);      // "1.0.0"
console.log(discovery.environment);  // "development"

// Check if a service is available before using it
if (discovery.services?.auth?.enabled) {
  // Auth plugin is installed — login is available
  await client.auth.login({ username: 'admin', password: 'secret' });
} else {
  console.log(discovery.services?.auth?.message);
  // → "Install an auth plugin to enable"
}
```

<Callout type="info">
**Plugin-driven services**: Auth, workflow, automation, AI, and other services are only available when the corresponding plugin is installed. Always check `discovery.services` before calling plugin-provided API methods.
</Callout>

---

## API Namespaces

### `client.meta` — Metadata

```typescript
// Get object schema
const accountSchema = await client.meta.getObject('account');
console.log(accountSchema.fields);

// List all metadata types
const types = await client.meta.getTypes();
// → { types: ['object', 'view', 'plugin', ...] }

// Get with ETag caching
const cached = await client.meta.getCached('account', {
  ifNoneMatch: '"686897696a7c876b7e"'
});
if (cached.notModified) {
  console.log('Using cached metadata');
}

// Get auto-generated view
const listView = await client.meta.getView('account', 'list');
```

### `client.data` — CRUD & Batch

```typescript
// Find with query options
const accounts = await client.data.find('account', {
  select: ['name', 'industry', 'revenue'],
  filters: ['industry', '=', 'Technology'],
  sort: ['-revenue'],
  top: 20,
  skip: 0,
});

// Get by ID
const account = await client.data.get('account', '123');

// Create
const created = await client.data.create('account', {
  name: 'Acme Corp',
  industry: 'Technology',
});

// Update (partial)
const updated = await client.data.update('account', '123', {
  industry: 'Healthcare',
});

// Delete
await client.data.delete('account', '123');

// Batch operation (recommended for bulk)
const batchResult = await client.data.batch('account', {
  operation: 'upsert',
  records: [
    { id: '1', data: { name: 'Acme', status: 'active' } },
    { id: '2', data: { name: 'Beta', status: 'active' } },
  ],
  options: {
    atomic: true,
    returnRecords: true,
    continueOnError: false,
    validateOnly: false,
  },
});

// Convenience bulk methods
await client.data.createMany('account', [{ name: 'A' }, { name: 'B' }]);
await client.data.updateMany('account', [
  { id: '1', data: { status: 'closed' } },
  { id: '2', data: { status: 'closed' } },
]);
await client.data.deleteMany('account', ['1', '2', '3']);
```

### `client.analytics` — BI Queries

```typescript
// Semantic analytics query (cube-style)
const result = await client.analytics.query({
  cube: 'account',
  measures: ['revenue.sum', 'count'],
  dimensions: ['industry'],
  filters: [{ member: 'status', operator: 'equals', values: ['active'] }],
  limit: 100,
});

// Get cube metadata
const meta = await client.analytics.getMeta();
```

### `client.packages` — Package Management

```typescript
const packages = await client.packages.list();
await client.packages.install({ manifest: { name: 'plugin-auth', version: '1.0.0' } });
await client.packages.enable('plugin-auth');
await client.packages.disable('plugin-auth');
await client.packages.uninstall('plugin-auth');
```

---

## Query Builder

Build complex queries programmatically:

```typescript
import { createQuery, createFilter } from '@objectstack/client';

const query = createQuery('account')
  .select(['name', 'industry', 'revenue'])
  .where(
    createFilter()
      .and('industry', '=', 'Technology')
      .and('revenue', '>', 10000)
      .build()
  )
  .orderBy('-revenue')
  .limit(50)
  .build();

const results = await client.data.query('account', query);
```

---

## Query Options

The `find` method accepts an options object:

| Property | Type | Description | Example |
|:---------|:-----|:------------|:--------|
| `select` | `string[]` | Fields to retrieve | `['name', 'email']` |
| `filters` | `Map` or `AST` | Filter criteria | `['status', '=', 'active']` |
| `sort` | `string` or `string[]` | Sort order | `['-created_at']` |
| `top` | `number` | Limit records | `20` |
| `skip` | `number` | Offset for pagination | `0` |

### Batch Options

| Property | Type | Default | Description |
|:---------|:-----|:--------|:------------|
| `atomic` | `boolean` | `true` | Rollback entire batch on any failure |
| `returnRecords` | `boolean` | `false` | Include full records in response |
| `continueOnError` | `boolean` | `false` | Continue after errors (when atomic=false) |
| `validateOnly` | `boolean` | `false` | Dry-run mode — validate without persisting |

---

## Error Handling

All errors follow a standardized format:

```typescript
try {
  await client.data.create('todo_task', { subject: '' });
} catch (error) {
  console.error(error.code);       // 'validation_error'
  console.error(error.category);   // 'validation'
  console.error(error.httpStatus); // 400
  console.error(error.retryable);  // false
  console.error(error.details);    // { ... }
}
```

### Error Codes

| Code | HTTP | Category | Retryable | Description |
|:-----|:-----|:---------|:----------|:------------|
| `validation_error` | 400 | validation | No | Input validation failed |
| `invalid_query` | 400 | validation | No | Malformed query expression |
| `unauthenticated` | 401 | auth | No | Authentication required |
| `permission_denied` | 403 | auth | No | Insufficient permissions |
| `resource_not_found` | 404 | request | No | Resource does not exist |
| `rate_limit_exceeded` | 429 | rate_limit | Yes | Too many requests |
| `internal_error` | 500 | server | Yes | Unexpected server error |
| `service_unavailable` | 503 | server | Yes | Service temporarily unavailable |
| `not_implemented` | 501 | server | No | Service not installed (plugin missing) |

---

## Configuration

```typescript
interface ClientConfig {
  /** ObjectStack server URL */
  baseUrl: string;
  /** Bearer token for authentication (if auth plugin installed) */
  token?: string;
  /** Custom fetch implementation (e.g. for SSR or testing) */
  fetch?: typeof fetch;
  /** Request timeout in ms (default: 30000) */
  timeout?: number;
}
```

---

## React Hooks

For React applications, use `@objectstack/client-react`:

```bash
pnpm add @objectstack/client-react
```

```typescript
import { useObjectStack, useFind, useGet } from '@objectstack/client-react';

function AccountList() {
  const { data: accounts, loading } = useFind('account', {
    filters: ['status', '=', 'active'],
    sort: ['-created_at'],
    top: 20,
  });

  if (loading) return <div>Loading...</div>;
  return accounts.map(a => <div key={a.id}>{a.name}</div>);
}
```

---

## Next Steps

<Cards>
  <Card 
    href="./api-reference" 
    title="API Reference"
    description="Complete REST endpoint documentation"
  />
  <Card 
    href="./kernel-services" 
    title="Kernel Services"
    description="Service checklist and plugin development guide"
  />
  <Card 
    href="../references/api/protocol" 
    title="Protocol Types"
    description="All 57 Zod protocol schemas"
  />
</Cards>