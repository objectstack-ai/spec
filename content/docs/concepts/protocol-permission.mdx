---
title: Permission Protocol
description: Fine-grained access control with object permissions, field-level security, sharing rules, and territory management.
---

import { Shield, Lock, Users, Globe } from 'lucide-react';

# Permission Protocol

The **Permission Protocol** provides comprehensive access control for ObjectStack applications. It includes object-level permissions (CRUD), field-level security (FLS), sharing rules, and territory-based access management.

## Overview

ObjectStack implements a multi-layered permission model similar to enterprise platforms like Salesforce. Access is evaluated through multiple checks, from object-level down to individual fields.

<Cards>
  <Card
    icon={<Shield />}
    title="Object Permissions"
    description="CRUD permissions at the object level via roles and permission sets."
  />
  <Card
    icon={<Lock />}
    title="Field-Level Security"
    description="Control access to individual fields, independent of object permissions."
  />
  <Card
    icon={<Users />}
    title="Sharing Rules"
    description="Grant access to specific records based on ownership or criteria."
  />
  <Card
    icon={<Globe />}
    title="Territory Management"
    description="Geographic or organizational hierarchy-based access control."
  />
</Cards>

## Key Concepts

### 1. Object Permissions

Object permissions control CRUD operations at the object level:

```typescript
import { Permission } from '@objectstack/spec';

const objectPermission: Permission.ObjectPermission = {
  object: 'account',
  allowCreate: true,
  allowRead: true,
  allowUpdate: true,
  allowDelete: false,
  viewAllRecords: false,
  modifyAllRecords: false
};
```

**Permission Levels:**
- `allowCreate` - Can create new records
- `allowRead` - Can view records (filtered by sharing)
- `allowUpdate` - Can edit records they have access to
- `allowDelete` - Can delete records they have access to
- `viewAllRecords` - Bypass sharing rules for read
- `modifyAllRecords` - Bypass sharing rules for write

### 2. Field-Level Security (FLS)

Field-level security controls access to individual fields:

```typescript
const fieldPermission: Permission.FieldPermission = {
  object: 'account',
  field: 'annual_revenue',
  readable: true,
  editable: false
};
```

**Use Cases:**
- Hide sensitive data (SSN, salary) from certain roles
- Make fields read-only for specific users
- Require special permissions to edit critical fields

### 3. Organization-Wide Defaults (OWD)

OWD defines the baseline sharing level for each object:

```typescript
const owdModel: Permission.OWDModel = {
  object: 'account',
  internalAccess: 'private',  // private | read_only | read_write
  externalAccess: 'private'   // For portal users
};
```

**Sharing Levels:**
- `private` - Only owner can access
- `read_only` - All users can read, only owner can edit
- `read_write` - All users can read and edit

### 4. Sharing Rules

Sharing rules grant additional access beyond OWD:

#### Ownership-Based Sharing

```typescript
const ownerSharingRule: Permission.OwnerSharingRule = {
  name: 'share_accounts_with_managers',
  object: 'account',
  ownedBy: {
    type: 'role',
    value: 'sales_rep'
  },
  sharedWith: {
    type: 'role',
    value: 'sales_manager'
  },
  accessLevel: 'read_only'
};
```

#### Criteria-Based Sharing

```typescript
const criteriaSharingRule: Permission.CriteriaSharingRule = {
  name: 'share_enterprise_accounts',
  object: 'account',
  criteria: {
    and: [
      { field: 'type', operator: 'equals', value: 'Enterprise' },
      { field: 'annual_revenue', operator: 'greaterThan', value: 10000000 }
    ]
  },
  sharedWith: {
    type: 'public_group',
    value: 'enterprise_sales_team'
  },
  accessLevel: 'read_write'
};
```

### 5. Territory Management

Territories provide hierarchical, rule-based access:

```typescript
const territory: Permission.Territory = {
  name: 'north_america',
  label: 'North America',
  parentTerritory: 'global',
  rules: [
    {
      field: 'billing_country',
      operator: 'in',
      values: ['USA', 'Canada', 'Mexico']
    }
  ]
};

const territoryModel: Permission.TerritoryModel = {
  object: 'account',
  enabled: true,
  assignmentPriority: 'most_specific'
};
```

## Permission Evaluation Flow

When a user requests access to a record, the system evaluates:

```
1. Object Permission
   ├─ Does user's role have READ permission on Account?
   │  ├─ YES → Continue
   │  └─ NO  → DENY (403)
   │
2. Record-Level Access (Sharing)
   ├─ Is user the owner?
   │  └─ YES → GRANT
   ├─ Does OWD grant access?
   │  └─ YES → GRANT
   ├─ Do sharing rules grant access?
   │  └─ YES → GRANT
   ├─ Does user have "View All" permission?
   │  └─ YES → GRANT
   └─ Otherwise → DENY (404 - hide existence)
   │
3. Field-Level Security
   ├─ For each field in response:
   │  ├─ Is field readable by user?
   │  │  ├─ YES → Include in response
   │  │  └─ NO  → Exclude from response
   │
4. Final Response
   └─ Return record with allowed fields only
```

## Permission Sets

Permission sets bundle multiple permissions:

```typescript
const permissionSet: Permission.PermissionSet = {
  name: 'sales_manager_permissions',
  label: 'Sales Manager Permissions',
  objectPermissions: [
    {
      object: 'account',
      allowCreate: true,
      allowRead: true,
      allowUpdate: true,
      allowDelete: false,
      viewAllRecords: true
    },
    {
      object: 'opportunity',
      allowCreate: true,
      allowRead: true,
      allowUpdate: true,
      allowDelete: true,
      modifyAllRecords: true
    }
  ],
  fieldPermissions: [
    {
      object: 'account',
      field: 'annual_revenue',
      readable: true,
      editable: true
    }
  ]
};
```

## Role Hierarchy

Roles inherit permissions from parent roles:

```
CEO (can see everything)
 └── VP Sales (can see sales data)
      ├── Sales Manager West (can see west region)
      │    └── Sales Rep West
      └── Sales Manager East (can see east region)
           └── Sales Rep East
```

Users in parent roles automatically get access to records visible to child roles.

## Best Practices

1. **Start with restrictive OWD** - Use 'private' as default, grant access via sharing rules
2. **Use permission sets for temporary access** - Assign additional permissions without changing roles
3. **Leverage criteria-based sharing** - Automatic sharing based on field values
4. **Implement territory management for geographic sales** - Cleaner than manual sharing rules
5. **Audit permission changes** - Track who granted/revoked access and when
6. **Test with different user profiles** - Verify permissions work as expected

## Common Patterns

### Read-Only Access for External Users

```typescript
const externalOWD: Permission.OWDModel = {
  object: 'case',
  internalAccess: 'private',
  externalAccess: 'read_only'  // Portal users can read their cases
};
```

### Manager Access to Team Records

```typescript
const managerRule: Permission.OwnerSharingRule = {
  name: 'manager_team_access',
  object: 'opportunity',
  ownedBy: { type: 'role_and_subordinates', value: 'sales_rep' },
  sharedWith: { type: 'role', value: 'sales_manager' },
  accessLevel: 'read_write'
};
```

### Temporary Project Access

```typescript
const projectPermissionSet: Permission.PermissionSet = {
  name: 'project_alpha_access',
  label: 'Project Alpha Access (Temporary)',
  objectPermissions: [{
    object: 'confidential_project',
    allowRead: true
  }]
};
// Assign to specific users, revoke when project ends
```

## Learn More

- [Object Permission Reference](/docs/references/permission/permission/ObjectPermission)
- [Sharing Rules Guide](/docs/references/permission/sharing/SharingRule)
- [Territory Management](/docs/references/permission/territory/Territory)
- [Field-Level Security](/docs/references/permission/permission/FieldPermission)
