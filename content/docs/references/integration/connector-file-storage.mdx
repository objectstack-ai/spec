---
title: File Storage Connector
description: File storage system connector protocol
---

# File Storage Connector

<Callout type="info">
**Source:** `packages/spec/src/integration/connector/file-storage.zod.ts`
</Callout>

## Overview

File Storage Connector protocol defines a specialized connector for file storage systems (S3, Azure Blob, Google Cloud Storage, etc.). It extends the base connector with file-specific features like multipart uploads, versioning, and metadata extraction.

## TypeScript Usage

```typescript
import { 
  FileStorageConnectorSchema,
  FileStorageProviderSchema,
  StorageBucketSchema,
  FileMetadataConfigSchema,
  MultipartUploadConfigSchema
} from '@objectstack/spec/integration/connector/file-storage';

import type {
  FileStorageConnector,
  FileStorageProvider,
  StorageBucket,
  FileMetadataConfig
} from '@objectstack/spec/integration/connector/file-storage';
```

---

## Schemas

### FileStorageProvider

Supported file storage providers.

**Values:**
- `s3` - Amazon S3
- `azure_blob` - Azure Blob Storage
- `gcs` - Google Cloud Storage
- `dropbox` - Dropbox
- `box` - Box
- `onedrive` - Microsoft OneDrive
- `google_drive` - Google Drive
- `sharepoint` - SharePoint
- `ftp` - FTP/SFTP
- `local` - Local file system
- `custom` - Custom file storage

---

### FileAccessPattern

File access control patterns.

**Values:**
- `public_read` - Public read access
- `private` - Private access
- `authenticated_read` - Requires authentication
- `bucket_owner_read` - Bucket owner has read access
- `bucket_owner_full` - Bucket owner has full control

---

### StorageBucket

Bucket/container configuration for file storage.

#### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **name** | `string` | ✅ | Bucket identifier in ObjectStack (snake_case) |
| **label** | `string` | ✅ | Display label |
| **bucketName** | `string` | ✅ | Actual bucket/container name in storage system |
| **region** | `string` | optional | Storage region |
| **enabled** | `boolean` | optional | Enable sync for this bucket (default: true) |
| **prefix** | `string` | optional | Prefix/path within bucket |
| **accessPattern** | `FileAccessPattern` | optional | Access pattern |
| **fileFilters** | `FileFilterConfig` | optional | File filter configuration |

---

### FileMetadataConfig

File metadata extraction configuration.

#### Properties

| Property | Type | Required | Default | Description |
| :--- | :--- | :--- | :--- | :--- |
| **extractMetadata** | `boolean` | optional | true | Extract file metadata |
| **metadataFields** | `string[]` | optional | - | Metadata fields to extract |
| **customMetadata** | `Record<string, string>` | optional | - | Custom metadata key-value pairs |

**Metadata Fields:**
- `content_type` - MIME type
- `file_size` - File size in bytes
- `last_modified` - Last modification date
- `etag` - Entity tag
- `checksum` - File checksum
- `creator` - File creator
- `created_at` - Creation date
- `custom` - Custom metadata

---

### MultipartUploadConfig

Multipart upload configuration for large files.

#### Properties

| Property | Type | Required | Default | Description |
| :--- | :--- | :--- | :--- | :--- |
| **enabled** | `boolean` | optional | true | Enable multipart uploads |
| **partSize** | `number` | optional | 5MB | Part size in bytes (min 5MB) |
| **maxConcurrentParts** | `number` | optional | 5 | Maximum concurrent part uploads |
| **threshold** | `number` | optional | 100MB | File size threshold for multipart upload |

---

### FileVersioningConfig

File versioning configuration.

#### Properties

| Property | Type | Required | Default | Description |
| :--- | :--- | :--- | :--- | :--- |
| **enabled** | `boolean` | optional | false | Enable file versioning |
| **maxVersions** | `number` | optional | - | Maximum versions to retain (1-100) |
| **retentionDays** | `number` | optional | - | Version retention period in days |

---

## FileStorageConnector

Complete file storage connector configuration.

### Additional Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **type** | `'file_storage'` | ✅ | Connector type |
| **provider** | `FileStorageProvider` | ✅ | File storage provider |
| **buckets** | `StorageBucket[]` | ✅ | Buckets/containers to sync |
| **storageConfig** | `object` | optional | Storage configuration |
| **metadataConfig** | `FileMetadataConfig` | optional | Metadata extraction |
| **multipartConfig** | `MultipartUploadConfig` | optional | Multipart upload |
| **versioningConfig** | `FileVersioningConfig` | optional | File versioning |
| **encryption** | `object` | optional | Server-side encryption |
| **lifecyclePolicy** | `object` | optional | File lifecycle policy |
| **contentProcessing** | `object` | optional | Content processing |

---

## Examples

### Amazon S3 Connector

```typescript
const s3Connector: FileStorageConnector = {
  name: 's3_documents',
  label: 'S3 Document Storage',
  type: 'file_storage',
  provider: 's3',
  enabled: true,
  
  storageConfig: {
    region: 'us-east-1',
  },
  
  buckets: [
    {
      name: 'customer_documents',
      label: 'Customer Documents',
      bucketName: 'myapp-customer-docs',
      region: 'us-east-1',
      enabled: true,
      prefix: 'documents/',
      accessPattern: 'private',
    }
  ],
  
  metadataConfig: {
    extractMetadata: true,
    metadataFields: ['content_type', 'file_size', 'last_modified'],
  },
  
  multipartConfig: {
    enabled: true,
    partSize: 10 * 1024 * 1024, // 10MB
    maxConcurrentParts: 5,
    threshold: 100 * 1024 * 1024, // 100MB
  },
  
  encryption: {
    enabled: true,
    algorithm: 'aws:kms',
    kmsKeyId: 'arn:aws:kms:us-east-1:123456789012:key/abc-123',
  },
};
```

### Azure Blob Storage

```typescript
const azureConnector: FileStorageConnector = {
  name: 'azure_files',
  label: 'Azure File Storage',
  type: 'file_storage',
  provider: 'azure_blob',
  enabled: true,
  
  buckets: [
    {
      name: 'attachments',
      label: 'Email Attachments',
      bucketName: 'email-attachments',
      enabled: true,
      accessPattern: 'private',
    }
  ],
  
  versioningConfig: {
    enabled: true,
    maxVersions: 10,
    retentionDays: 90,
  },
};
```

### Google Cloud Storage

```typescript
const gcsConnector: FileStorageConnector = {
  name: 'gcs_media',
  label: 'GCS Media Storage',
  type: 'file_storage',
  provider: 'gcs',
  enabled: true,
  
  buckets: [
    {
      name: 'user_uploads',
      label: 'User Uploads',
      bucketName: 'myapp-user-uploads',
      enabled: true,
      accessPattern: 'authenticated_read',
      fileFilters: {
        allowedExtensions: ['.jpg', '.png', '.pdf'],
        maxFileSize: 50 * 1024 * 1024, // 50MB
      },
    }
  ],
  
  contentProcessing: {
    generateThumbnails: true,
    thumbnailSizes: [
      { width: 150, height: 150 },
      { width: 300, height: 300 },
    ],
    virusScan: true,
  },
};
```

### With File Filters

```typescript
const filteredConnector: FileStorageConnector = {
  name: 'filtered_storage',
  label: 'Filtered Storage',
  type: 'file_storage',
  provider: 's3',
  enabled: true,
  
  buckets: [
    {
      name: 'documents',
      label: 'Documents',
      bucketName: 'my-docs',
      enabled: true,
      fileFilters: {
        includePatterns: ['*.pdf', '*.docx', '*.xlsx'],
        excludePatterns: ['temp/*', '*/draft/*'],
        minFileSize: 1024, // 1KB
        maxFileSize: 100 * 1024 * 1024, // 100MB
        allowedExtensions: ['.pdf', '.docx', '.xlsx'],
        blockedExtensions: ['.exe', '.bat', '.sh'],
      },
    }
  ],
};
```

### With Lifecycle Policy

```typescript
const lifecycleConnector: FileStorageConnector = {
  name: 'archive_storage',
  label: 'Archive Storage',
  type: 'file_storage',
  provider: 's3',
  enabled: true,
  
  buckets: [
    {
      name: 'logs',
      label: 'Application Logs',
      bucketName: 'app-logs',
      enabled: true,
    }
  ],
  
  lifecyclePolicy: {
    enabled: true,
    archiveAfterDays: 30,
    deleteAfterDays: 365,
  },
};
```

---

## Best Practices

### 1. Enable Multipart for Large Files

```typescript
multipartConfig: {
  enabled: true,
  partSize: 10 * 1024 * 1024, // 10MB parts
  threshold: 50 * 1024 * 1024, // Use multipart for files > 50MB
}
```

### 2. Use File Filters

```typescript
fileFilters: {
  allowedExtensions: ['.pdf', '.jpg', '.png'],
  maxFileSize: 100 * 1024 * 1024, // 100MB limit
  excludePatterns: ['temp/*', '*/cache/*'],
}
```

### 3. Enable Encryption

```typescript
encryption: {
  enabled: true,
  algorithm: 'aws:kms', // Use KMS for better security
  kmsKeyId: 'your-kms-key-id',
}
```

### 4. Configure Versioning Carefully

```typescript
versioningConfig: {
  enabled: true,
  maxVersions: 5, // Keep only recent versions
  retentionDays: 30, // Auto-delete old versions
}
```

---

## Related

- [Connector](/docs/references/integration/connector) - Base connector protocol
- [Object Storage](/docs/references/integration/object-storage) - Object storage integration
- [Datasource](/docs/references/system/datasource) - Datasource configuration
