---
title: Conversation
description: Conversation protocol schemas
---

# Conversation

<Callout type="info">
**Source:** `packages/spec/src/ai/conversation.zod.ts`
</Callout>

## TypeScript Usage

```typescript
import { ConversationAnalyticsSchema, ConversationContextSchema, ConversationMessageSchema, ConversationSessionSchema, ConversationSummarySchema, FunctionCallSchema, MessageContentSchema, MessageContentTypeSchema, MessagePruningEventSchema, MessageRoleSchema, TokenBudgetConfigSchema, TokenBudgetStrategySchema, TokenUsageStatsSchema, ToolCallSchema } from '@objectstack/spec/ai';
import type { ConversationAnalytics, ConversationContext, ConversationMessage, ConversationSession, ConversationSummary, FunctionCall, MessageContent, MessageContentType, MessagePruningEvent, MessageRole, TokenBudgetConfig, TokenBudgetStrategy, TokenUsageStats, ToolCall } from '@objectstack/spec/ai';

// Validate data
const result = ConversationAnalyticsSchema.parse(data);
```

---

## ConversationAnalytics

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **sessionId** | `string` | ✅ |  |
| **totalMessages** | `integer` | ✅ |  |
| **userMessages** | `integer` | ✅ |  |
| **assistantMessages** | `integer` | ✅ |  |
| **systemMessages** | `integer` | ✅ |  |
| **totalTokens** | `integer` | ✅ |  |
| **averageTokensPerMessage** | `number` | ✅ |  |
| **peakTokenUsage** | `integer` | ✅ |  |
| **pruningEvents** | `integer` | optional |  |
| **summarizationEvents** | `integer` | optional |  |
| **tokensSavedByPruning** | `integer` | optional |  |
| **tokensSavedBySummarization** | `integer` | optional |  |
| **duration** | `number` | optional | Session duration in seconds |
| **firstMessageAt** | `string` | optional | ISO 8601 timestamp |
| **lastMessageAt** | `string` | optional | ISO 8601 timestamp |

---

## ConversationContext

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **sessionId** | `string` | ✅ | Conversation session ID |
| **userId** | `string` | optional | User identifier |
| **agentId** | `string` | optional | AI agent identifier |
| **object** | `string` | optional | Related object (e.g., "case", "project") |
| **recordId** | `string` | optional | Related record ID |
| **scope** | `Record<string, any>` | optional | Additional context scope |
| **systemMessage** | `string` | optional | System prompt/instructions |
| **metadata** | `Record<string, any>` | optional |  |

---

## ConversationMessage

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **id** | `string` | ✅ | Unique message ID |
| **timestamp** | `string` | ✅ | ISO 8601 timestamp |
| **role** | `Enum<'system' \| 'user' \| 'assistant' \| 'function' \| 'tool'>` | ✅ |  |
| **content** | `string \| object[]` | ✅ | Message content (text or multimodal) |
| **functionCall** | `object` | optional | Legacy function call |
| **toolCalls** | `object[]` | optional | Tool calls |
| **toolCallId** | `string` | optional | Tool call ID this message responds to |
| **name** | `string` | optional | Name of the function/user |
| **tokens** | `object` | optional | Token usage for this message |
| **pinned** | `boolean` | optional | Prevent removal during pruning |
| **importance** | `number` | optional | Importance score for pruning |
| **embedding** | `number[]` | optional | Vector embedding for semantic search |
| **metadata** | `Record<string, any>` | optional |  |

---

## ConversationSession

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **id** | `string` | ✅ | Unique session ID |
| **name** | `string` | optional | Session name/title |
| **context** | `object` | ✅ |  |
| **modelId** | `string` | optional | AI model ID |
| **tokenBudget** | `object` | ✅ |  |
| **messages** | `object[]` | optional |  |
| **tokens** | `object` | optional |  |
| **status** | `Enum<'active' \| 'paused' \| 'completed' \| 'archived'>` | optional |  |
| **createdAt** | `string` | ✅ | ISO 8601 timestamp |
| **updatedAt** | `string` | ✅ | ISO 8601 timestamp |
| **expiresAt** | `string` | optional | ISO 8601 timestamp |
| **tags** | `string[]` | optional |  |
| **metadata** | `Record<string, any>` | optional |  |

---

## ConversationSummary

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **summary** | `string` | ✅ | Conversation summary |
| **keyPoints** | `string[]` | optional | Key discussion points |
| **originalTokens** | `integer` | ✅ | Original token count |
| **summaryTokens** | `integer` | ✅ | Summary token count |
| **tokensSaved** | `integer` | ✅ | Tokens saved |
| **messageRange** | `object` | ✅ | Range of messages summarized |
| **generatedAt** | `string` | ✅ | ISO 8601 timestamp |
| **modelId** | `string` | optional | Model used for summarization |

---

## FunctionCall

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **name** | `string` | ✅ | Function name |
| **arguments** | `string` | ✅ | JSON string of function arguments |
| **result** | `string` | optional | Function execution result |

---

## MessageContent

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **type** | `Enum<'text' \| 'image' \| 'file' \| 'code' \| 'structured'>` | optional |  |
| **text** | `string` | optional | Text content |
| **imageUrl** | `string` | optional | Image URL for vision models |
| **fileUrl** | `string` | optional | File attachment URL |
| **mimeType** | `string` | optional | MIME type for files |
| **metadata** | `Record<string, any>` | optional | Additional metadata |

---

## MessageContentType

### Allowed Values

* `text`
* `image`
* `file`
* `code`
* `structured`

---

## MessagePruningEvent

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **timestamp** | `string` | ✅ | ISO 8601 timestamp |
| **strategy** | `Enum<'fifo' \| 'importance' \| 'semantic' \| 'sliding_window' \| 'summary'>` | ✅ |  |
| **reason** | `string` | ✅ | Reason for pruning |
| **prunedMessages** | `object[]` | ✅ |  |
| **tokensFreed** | `integer` | ✅ |  |
| **messagesRemoved** | `integer` | ✅ |  |
| **remainingTokens** | `integer` | ✅ |  |
| **remainingMessages** | `integer` | ✅ |  |

---

## MessageRole

### Allowed Values

* `system`
* `user`
* `assistant`
* `function`
* `tool`

---

## TokenBudgetConfig

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **maxTokens** | `integer` | ✅ | Maximum total tokens |
| **maxPromptTokens** | `integer` | optional | Max tokens for prompt |
| **maxCompletionTokens** | `integer` | optional | Max tokens for completion |
| **reserveTokens** | `integer` | optional | Reserve tokens for system messages |
| **bufferPercentage** | `number` | optional | Buffer percentage (0.1 = 10%) |
| **strategy** | `Enum<'fifo' \| 'importance' \| 'semantic' \| 'sliding_window' \| 'summary'>` | optional |  |
| **slidingWindowSize** | `integer` | optional | Number of recent messages to keep |
| **minImportanceScore** | `number` | optional | Minimum importance to keep |
| **semanticThreshold** | `number` | optional | Semantic similarity threshold |
| **enableSummarization** | `boolean` | optional | Enable context summarization |
| **summarizationThreshold** | `integer` | optional | Trigger summarization at N tokens |
| **summaryModel** | `string` | optional | Model ID for summarization |
| **warnThreshold** | `number` | optional | Warn at % of budget (0.8 = 80%) |

---

## TokenBudgetStrategy

### Allowed Values

* `fifo`
* `importance`
* `semantic`
* `sliding_window`
* `summary`

---

## TokenUsageStats

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **promptTokens** | `integer` | optional |  |
| **completionTokens** | `integer` | optional |  |
| **totalTokens** | `integer` | optional |  |
| **budgetLimit** | `integer` | ✅ |  |
| **budgetUsed** | `integer` | optional |  |
| **budgetRemaining** | `integer` | ✅ |  |
| **budgetPercentage** | `number` | ✅ | Usage as percentage of budget |
| **messageCount** | `integer` | optional |  |
| **prunedMessageCount** | `integer` | optional |  |
| **summarizedMessageCount** | `integer` | optional |  |

---

## ToolCall

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **id** | `string` | ✅ | Tool call ID |
| **type** | `Enum<'function'>` | optional |  |
| **function** | `object` | ✅ |  |

