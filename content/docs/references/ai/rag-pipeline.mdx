---
title: Rag Pipeline
description: Rag Pipeline protocol schemas
---

# Rag Pipeline

<Callout type="info">
**Source:** `packages/spec/src/ai/rag-pipeline.zod.ts`
</Callout>

## TypeScript Usage

```typescript
import { ChunkingStrategySchema, DocumentChunkSchema, DocumentLoaderConfigSchema, DocumentMetadataSchema, EmbeddingModelSchema, RAGPipelineConfigSchema, RAGPipelineStatusSchema, RAGQueryRequestSchema, RAGQueryResponseSchema, RerankingConfigSchema, RetrievalStrategySchema, VectorStoreConfigSchema, VectorStoreProviderSchema } from '@objectstack/spec/ai';
import type { ChunkingStrategy, DocumentChunk, DocumentLoaderConfig, DocumentMetadata, EmbeddingModel, RAGPipelineConfig, RAGPipelineStatus, RAGQueryRequest, RAGQueryResponse, RerankingConfig, RetrievalStrategy, VectorStoreConfig, VectorStoreProvider } from '@objectstack/spec/ai';

// Validate data
const result = ChunkingStrategySchema.parse(data);
```

---

## ChunkingStrategy

---

## DocumentChunk

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **id** | `string` | ✅ | Unique chunk identifier |
| **content** | `string` | ✅ | Chunk text content |
| **embedding** | `number[]` | optional | Embedding vector |
| **metadata** | `object` | ✅ |  |
| **chunkIndex** | `integer` | ✅ | Chunk position in document |
| **tokens** | `integer` | optional | Token count |

---

## DocumentLoaderConfig

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **type** | `Enum<'file' \| 'directory' \| 'url' \| 'api' \| 'database' \| 'custom'>` | ✅ |  |
| **source** | `string` | ✅ | Source path, URL, or identifier |
| **fileTypes** | `string[]` | optional | Accepted file extensions (e.g., [".pdf", ".md"]) |
| **recursive** | `boolean` | optional | Process directories recursively |
| **maxFileSize** | `integer` | optional | Maximum file size in bytes |
| **excludePatterns** | `string[]` | optional | Patterns to exclude |
| **extractImages** | `boolean` | optional | Extract text from images (OCR) |
| **extractTables** | `boolean` | optional | Extract and format tables |
| **loaderConfig** | `Record<string, any>` | optional | Custom loader-specific config |

---

## DocumentMetadata

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **source** | `string` | ✅ | Document source (file path, URL, etc.) |
| **sourceType** | `Enum<'file' \| 'url' \| 'api' \| 'database' \| 'custom'>` | optional |  |
| **title** | `string` | optional |  |
| **author** | `string` | optional |  |
| **createdAt** | `string` | optional | ISO timestamp |
| **updatedAt** | `string` | optional | ISO timestamp |
| **tags** | `string[]` | optional |  |
| **category** | `string` | optional |  |
| **language** | `string` | optional | Document language (ISO 639-1 code) |
| **custom** | `Record<string, any>` | optional | Custom metadata fields |

---

## EmbeddingModel

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **provider** | `Enum<'openai' \| 'cohere' \| 'huggingface' \| 'azure_openai' \| 'local' \| 'custom'>` | ✅ |  |
| **model** | `string` | ✅ | Model name (e.g., "text-embedding-3-large") |
| **dimensions** | `integer` | ✅ | Embedding vector dimensions |
| **maxTokens** | `integer` | optional | Maximum tokens per embedding |
| **batchSize** | `integer` | optional | Batch size for embedding |
| **endpoint** | `string` | optional | Custom endpoint URL |
| **apiKey** | `string` | optional | API key or reference to secret |

---

## RAGPipelineConfig

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **name** | `string` | ✅ | Pipeline name (snake_case) |
| **label** | `string` | ✅ | Display name |
| **description** | `string` | optional |  |
| **embedding** | `object` | ✅ |  |
| **vectorStore** | `object` | ✅ |  |
| **chunking** | `object \| object \| object \| object` | ✅ |  |
| **retrieval** | `object \| object \| object \| object` | ✅ |  |
| **reranking** | `object` | optional |  |
| **loaders** | `object[]` | optional | Document loaders |
| **maxContextTokens** | `integer` | optional | Maximum tokens in context |
| **contextWindow** | `integer` | optional | LLM context window size |
| **metadataFilters** | `Record<string, string \| number \| boolean \| string,number[]>` | optional | Filters for retrieval (e.g., `{category: "docs", status: "published"}`) |
| **enableCache** | `boolean` | optional |  |
| **cacheTTL** | `integer` | optional | Cache TTL in seconds |
| **cacheInvalidationStrategy** | `Enum<'time_based' \| 'manual' \| 'on_update'>` | optional |  |

---

## RAGPipelineStatus

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **name** | `string` | ✅ |  |
| **status** | `Enum<'active' \| 'indexing' \| 'error' \| 'disabled'>` | ✅ |  |
| **documentsIndexed** | `integer` | ✅ |  |
| **lastIndexed** | `string` | optional | ISO timestamp |
| **errorMessage** | `string` | optional |  |
| **health** | `object` | optional |  |

---

## RAGQueryRequest

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **query** | `string` | ✅ | User query |
| **pipelineName** | `string` | ✅ | Pipeline to use |
| **topK** | `integer` | optional |  |
| **metadataFilters** | `Record<string, any>` | optional |  |
| **conversationHistory** | `object[]` | optional |  |
| **includeMetadata** | `boolean` | optional |  |
| **includeSources** | `boolean` | optional |  |

---

## RAGQueryResponse

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **query** | `string` | ✅ |  |
| **results** | `object[]` | ✅ |  |
| **context** | `string` | ✅ | Assembled context for LLM |
| **tokens** | `object` | optional | Token usage for this query |
| **cost** | `number` | optional | Cost for this query in USD |
| **tokensUsed** | `integer` | optional | Deprecated: use tokens.total instead |
| **retrievalTime** | `number` | optional | Retrieval time in milliseconds |

---

## RerankingConfig

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **enabled** | `boolean` | optional |  |
| **model** | `string` | optional | Reranking model name |
| **provider** | `Enum<'cohere' \| 'huggingface' \| 'custom'>` | optional |  |
| **topK** | `integer` | optional | Final number of results after reranking |

---

## RetrievalStrategy

---

## VectorStoreConfig

### Properties

| Property | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **provider** | `Enum<'pinecone' \| 'weaviate' \| 'qdrant' \| 'milvus' \| 'chroma' \| 'pgvector' \| 'redis' \| 'opensearch' \| 'elasticsearch' \| 'custom'>` | ✅ |  |
| **indexName** | `string` | ✅ | Index/collection name |
| **namespace** | `string` | optional | Namespace for multi-tenancy |
| **host** | `string` | optional | Vector store host |
| **port** | `integer` | optional | Vector store port |
| **apiKey** | `string` | optional | API key or reference to secret |
| **dimensions** | `integer` | ✅ | Vector dimensions |
| **metric** | `Enum<'cosine' \| 'euclidean' \| 'dotproduct'>` | optional |  |
| **batchSize** | `integer` | optional |  |
| **connectionPoolSize** | `integer` | optional |  |
| **timeout** | `integer` | optional | Timeout in milliseconds |

---

## VectorStoreProvider

### Allowed Values

* `pinecone`
* `weaviate`
* `qdrant`
* `milvus`
* `chroma`
* `pgvector`
* `redis`
* `opensearch`
* `elasticsearch`
* `custom`

