---
title: FilterCondition
description: Recursive filter structure supporting implicit equality, explicit operators, and logical combinations
---

# FilterCondition

FilterCondition is the recursive data structure that represents filter criteria in ObjectStack. It supports three syntactic patterns: implicit equality, explicit operators, and logical combinations.

## Overview

FilterCondition is the core building block for all filter operations. It provides a flexible, MongoDB-inspired syntax that can express simple to complex query logic.

## Type Definition

```typescript
type FilterCondition = {
  [key: string]: 
    | any                              // Implicit equality
    | FieldOperators                   // Explicit operators
    | FilterCondition;                 // Nested relation
} & {
  $and?: FilterCondition[];           // Logical AND
  $or?: FilterCondition[];            // Logical OR
  $not?: FilterCondition;             // Logical NOT
};
```

## Syntax Patterns

### 1. Implicit Equality (Simplest)

The most common pattern - just assign a value to a field:

```typescript
{
  status: "active",
  verified: true,
  age: 18
}
```

**Equivalent to:**
```typescript
{
  status: { $eq: "active" },
  verified: { $eq: true },
  age: { $eq: 18 }
}
```

### 2. Explicit Operators

Use operator objects when you need more than equality:

```typescript
{
  age: { $gte: 18, $lte: 65 },
  email: { $contains: "@company.com" },
  role: { $in: ["admin", "editor"] },
  deletedAt: { $null: true }
}
```

### 3. Logical Combinations

Combine multiple conditions with `$and`, `$or`, `$not`:

```typescript
{
  $and: [
    { status: "active" },
    { age: { $gte: 18 } }
  ],
  $or: [
    { role: "admin" },
    { permissions: { $contains: "write" } }
  ],
  $not: {
    status: "deleted"
  }
}
```

### 4. Nested Relations

Filter on related objects using dot notation or nested structures:

```typescript
{
  department: {
    name: "Engineering",
    company: {
      country: "USA"
    }
  }
}
```

## Available Operators

### Equality Operators

| Operator | Description | Example |
| :--- | :--- | :--- |
| `$eq` | Equal to | `{ status: { $eq: "active" } }` |
| `$ne` | Not equal to | `{ status: { $ne: "deleted" } }` |

### Comparison Operators

| Operator | Types | Description | Example |
| :--- | :--- | :--- | :--- |
| `$gt` | number, Date | Greater than | `{ age: { $gt: 18 } }` |
| `$gte` | number, Date | Greater than or equal | `{ age: { $gte: 18 } }` |
| `$lt` | number, Date | Less than | `{ score: { $lt: 100 } }` |
| `$lte` | number, Date | Less than or equal | `{ age: { $lte: 65 } }` |

### Set Operators

| Operator | Description | Example |
| :--- | :--- | :--- |
| `$in` | Value in array | `{ role: { $in: ["admin", "editor"] } }` |
| `$nin` | Value not in array | `{ status: { $nin: ["spam", "deleted"] } }` |
| `$between` | Between range (inclusive) | `{ age: { $between: [18, 65] } }` |

### String Operators

| Operator | Description | Example |
| :--- | :--- | :--- |
| `$contains` | Contains substring | `{ email: { $contains: "@example.com" } }` |
| `$startsWith` | Starts with prefix | `{ username: { $startsWith: "admin_" } }` |
| `$endsWith` | Ends with suffix | `{ filename: { $endsWith: ".pdf" } }` |

### Special Operators

| Operator | Description | Example |
| :--- | :--- | :--- |
| `$null` | Is null (true) or not null (false) | `{ deletedAt: { $null: true } }` |
| `$exist` | Field exists | `{ metadata: { $exist: true } }` |

### Logical Operators

| Operator | Description | Example |
| :--- | :--- | :--- |
| `$and` | All conditions must be true | `{ $and: [{ a: 1 }, { b: 2 }] }` |
| `$or` | At least one condition must be true | `{ $or: [{ a: 1 }, { b: 2 }] }` |
| `$not` | Negates the condition | `{ $not: { status: "deleted" } }` |

## Usage Examples

### Basic Filtering

```typescript
// Simple equality
const filter: FilterCondition = {
  status: "active",
  verified: true
};

// With operators
const filter: FilterCondition = {
  age: { $gte: 18 },
  score: { $lt: 100 },
  email: { $contains: "@example.com" }
};

// Multiple operators on same field
const filter: FilterCondition = {
  age: { $gte: 18, $lte: 65 }
};
```

### Logical Combinations

```typescript
// Implicit AND (fields at same level)
const filter: FilterCondition = {
  status: "active",
  age: { $gte: 18 },
  verified: true
};

// Explicit OR
const filter: FilterCondition = {
  $or: [
    { role: "admin" },
    { role: "editor" },
    { role: "moderator" }
  ]
};

// Complex nested logic
const filter: FilterCondition = {
  status: "active",
  $and: [
    {
      $or: [
        { priority: "high" },
        { urgent: true }
      ]
    },
    { assignee: { $null: false } }
  ]
};
```

### Nested Relations

```typescript
// Single level nesting
const filter: FilterCondition = {
  status: "active",
  owner: {
    department: "Engineering"
  }
};

// Multi-level nesting
const filter: FilterCondition = {
  status: "active",
  owner: {
    department: {
      company: {
        country: "USA"
      }
    }
  }
};

// Nested with operators
const filter: FilterCondition = {
  task: {
    status: { $in: ["todo", "in_progress"] },
    assignee: {
      role: "developer",
      team: {
        name: { $startsWith: "Backend" }
      }
    }
  }
};
```

### Real-World Examples

#### User Search Query
```typescript
const filter: FilterCondition = {
  $or: [
    { name: { $contains: "john" } },
    { email: { $contains: "john" } },
    { username: { $contains: "john" } }
  ],
  status: "active",
  role: { $in: ["user", "admin"] },
  createdAt: { $gte: new Date("2024-01-01") }
};
```

#### Task Management Filter
```typescript
const filter: FilterCondition = {
  $and: [
    {
      $or: [
        { priority: "high" },
        { dueDate: { $lt: new Date() } }
      ]
    },
    { status: { $ne: "completed" } },
    { assignee: { $null: false } }
  ],
  project: {
    status: "active",
    team: {
      department: "Engineering"
    }
  }
};
```

#### E-commerce Product Filter
```typescript
const filter: FilterCondition = {
  category: { $in: ["electronics", "computers"] },
  price: { $between: [100, 1000] },
  inStock: true,
  $or: [
    { rating: { $gte: 4.5 } },
    { reviews: { $gt: 100 } }
  ],
  brand: {
    verified: true,
    country: { $in: ["USA", "Germany", "Japan"] }
  }
};
```

#### Content Management Filter
```typescript
const filter: FilterCondition = {
  $and: [
    { published: true },
    { deletedAt: { $null: true } }
  ],
  $or: [
    { title: { $contains: "tutorial" } },
    { content: { $contains: "guide" } },
    { tags: { name: { $in: ["tutorial", "guide", "howto"] } } }
  ],
  author: {
    verified: true,
    role: { $in: ["editor", "admin"] },
    posts: { count: { $gt: 10 } }
  },
  publishedAt: {
    $gte: new Date("2024-01-01")
  }
};
```

## TypeScript Type Safety

Use the generic `Filter<T>` type for type-safe filters:

```typescript
interface User {
  id: number;
  name: string;
  age: number;
  email: string;
  verified: boolean;
  profile: {
    bio: string;
    avatar?: string;
  };
}

// Type-safe filter
const filter: Filter<User> = {
  age: { $gte: 18 },              // ✓ Valid
  email: { $contains: "@" },       // ✓ Valid
  verified: true,                  // ✓ Valid
  profile: {
    bio: { $contains: "developer" } // ✓ Valid
  },
  // status: "active"              // ✗ Error: 'status' doesn't exist on User
};
```

## Combining with Other Query Features

FilterCondition is typically used as the `where` clause in a `Query`:

```typescript
const query: Query = {
  object: "user",
  fields: ["name", "email", "age"],
  where: {                          // FilterCondition here
    status: "active",
    age: { $gte: 18 },
    $or: [
      { role: "admin" },
      { verified: true }
    ]
  },
  sort: [{ field: "createdAt", order: "desc" }],
  top: 10
};
```

## Design Principles

1. **Declarative**: Describe what you want, not how to get it
2. **Composable**: Build complex filters from simple conditions
3. **Type-safe**: Full TypeScript support with inference
4. **Database-agnostic**: Works with SQL, NoSQL, and other backends
5. **Human-readable**: Easy to write and understand

## Best Practices

### Do ✓

```typescript
// Use implicit equality for simple cases
{ status: "active", verified: true }

// Combine operators on same field when needed
{ age: { $gte: 18, $lte: 65 } }

// Use $or at appropriate level
{
  status: "active",
  $or: [{ role: "admin" }, { role: "editor" }]
}
```

### Don't ✗

```typescript
// Don't use $eq unnecessarily
{ status: { $eq: "active" } }  // Just use: { status: "active" }

// Don't create redundant $and
{
  $and: [{ status: "active" }]  // Just use: { status: "active" }
}

// Don't mix patterns unnecessarily
{
  status: { $eq: "active" },    // Inconsistent
  verified: true
}
```

## Performance Considerations

1. **Index Fields**: Ensure frequently filtered fields have database indexes
2. **Avoid Complex Nesting**: Keep filter depth reasonable for query optimization
3. **Use Specific Operators**: `$eq` is faster than `$contains` for exact matches
4. **Limit OR Branches**: Too many `$or` branches can impact performance

## See Also

- [QueryFilter](./QueryFilter.mdx) - Top-level query filter wrapper
- [NormalizedFilter](./NormalizedFilter.mdx) - Internal AST representation
- [Query](./types/Query.mdx) - Complete query specification
- [Field Operators](./logic/FilterOperator.mdx) - Detailed operator reference