---
title: 客户端 SDK
description: ObjectStack 官方 TypeScript 客户端
---

# Client SDK

`@objectstack/client-sdk` 是 ObjectStack 的官方 TypeScript 客户端。它提供了一个类型安全、感知协议的接口，用于与 ObjectStack Server 进行交互。

## 核心特性

- **自动发现 (Auto-Discovery)**: 连接到 Server 并自动配置 API 端点路由。
- **类型化元数据**: 获取对象和视图定义，并提供完整的类型支持。
- **统一数据访问**: 为 Schema 中的任何对象提供简单和高级的 CRUD 操作。

## 安装

```bash
pnpm add @objectstack/client-sdk
```

## 使用指南

```typescript
import { ObjectStackClient } from '@objectstack/client-sdk';

// 1. 初始化
const client = new ObjectStackClient({
  baseUrl: 'http://localhost:3004', // 你的 ObjectStack Server URL
  token: 'optional-auth-token'      // (可选) 认证 Token
});

async function main() {
  // 2. 连接 (获取服务端系统能力与路由表)
  await client.connect();

  // 3. 元数据访问
  const todoSchema = await client.meta.getObject('todo_task');
  console.log('Fields:', todoSchema.fields);

  // 4. 高级查询
  const tasks = await client.data.find<{ subject: string; priority: number }>('todo_task', {
    select: ['subject', 'priority'], // 字段选择
    filters: ['priority', '>=', 2],  // ObjectStack 过滤器 AST
    sort: ['-priority'],             // 排序
    top: 10
  });
  
  // 5. 创建数据
  const newTask = await client.data.create('todo_task', {
    subject: 'New Task',
    priority: 1
  });

  // 6. 批量操作
  await client.data.deleteMany('todo_task', ['id1', 'id2']);
}
```

## API 参考

### 初始化 (Initialization)
```typescript
const client = new ObjectStackClient(config: ClientConfig);
```
- `config.baseUrl`: ObjectStack Server 的地址。
- `config.token`: (可选) Bearer 认证 Token。
- `config.fetch`: (可选) 自定义的 fetch 实现 (例如用于 Next.js 服务端)。

### `client.connect()`
初始化客户端，从 `/api/v1` 获取系统发现清单 (Discovery Manifest)。这将动态映射元数据、数据和 UI 服务的路由。

### `client.meta`
- `getObject(name: string)`: 获取对象 Schema 定义。
- `getView(name: string)`: 获取视图配置 (例如用于自动生成 UI)。

### `client.data`
- `find<T>(object, options)`: 高级查询。
- `get<T>(object, id)`: 根据 ID 获取单条记录。
- `query<T>(object, ast)`: 使用完整 AST 执行复杂查询 (支持 Join, Aggregation 等)。
- `create<T>(object, data)`: 创建记录。
- `createMany<T>(object, data[])`: 批量创建。
- `update<T>(object, id, data)`: 更新记录。
- `updateMany<T>(object, ids[], data)`: 批量更新。
- `delete(object, id)`: 删除记录。
- `deleteMany(object, ids[])`: 批量删除。

### 查询选项 (`QueryOptions`)
`find` 方法接受一个选项对象来控制查询行为：

| 属性 | 类型 | 描述 | 示例 |
| :--- | :--- | :--- | :--- |
| `select` | `string[]` | 返回字段选择 | `['name', 'email']` |
| `filters` | `Map` or `AST` | 过滤条件 | `['status', '=', 'active']` |
| `sort` | `string` or `string[]` | 排序规则 | `['-created_at']` |
| `top` | `number` | 限制返回条数 | `20` |
| `skip` | `number` | 偏移量 (分页) | `0` |
